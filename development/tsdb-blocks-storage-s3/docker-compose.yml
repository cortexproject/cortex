"services":
  "alertmanager":
    "build":
      "context": "."
      "dockerfile": "dev.dockerfile"
    "command":
      - "sh"
      - "-c"
      - "sleep 3 && exec ./cortex -config.file=./config/cortex.yaml -target=alertmanager -server.http-listen-port=8010 -server.grpc-listen-port=9010 -alertmanager.web.external-url=localhost:8010"
    "depends_on":
      - "consul"
      - "minio"
    "environment":
      - "JAEGER_AGENT_HOST=jaeger"
      - "JAEGER_AGENT_PORT=6831"
      - "JAEGER_SAMPLER_PARAM=1"
      - "JAEGER_SAMPLER_TYPE=const"
      - "JAEGER_TAGS=app=alertmanager"
    "image": "cortex"
    "ports":
      - "8010:8010"
    "volumes":
      - "./config:/cortex/config"
  "compactor":
    "build":
      "context": "."
      "dockerfile": "dev.dockerfile"
    "command":
      - "sh"
      - "-c"
      - "sleep 3 && exec ./cortex -config.file=./config/cortex.yaml -target=compactor -server.http-listen-port=8006 -server.grpc-listen-port=9006 "
    "depends_on":
      - "consul"
      - "minio"
    "environment":
      - "JAEGER_AGENT_HOST=jaeger"
      - "JAEGER_AGENT_PORT=6831"
      - "JAEGER_SAMPLER_PARAM=1"
      - "JAEGER_SAMPLER_TYPE=const"
      - "JAEGER_TAGS=app=compactor"
    "image": "cortex"
    "ports":
      - "8006:8006"
    "volumes":
      - "./config:/cortex/config"
  "consul":
    "command":
      - "agent"
      - "-dev"
      - "-client=0.0.0.0"
      - "-log-level=info"
    "image": "consul"
    "ports":
      - "8500:8500"
  "distributor":
    "build":
      "context": "."
      "dockerfile": "dev.dockerfile"
    "command":
      - "sh"
      - "-c"
      - "sleep 3 && exec ./cortex -config.file=./config/cortex.yaml -target=distributor -server.http-listen-port=8001 -server.grpc-listen-port=9001 "
    "depends_on":
      - "consul"
      - "minio"
    "environment":
      - "JAEGER_AGENT_HOST=jaeger"
      - "JAEGER_AGENT_PORT=6831"
      - "JAEGER_SAMPLER_PARAM=1"
      - "JAEGER_SAMPLER_TYPE=const"
      - "JAEGER_TAGS=app=distributor"
    "image": "cortex"
    "ports":
      - "8001:8001"
    "volumes":
      - "./config:/cortex/config"
  "grafana-agent":
    "command":
      - "-config.file=/etc/agent-config/grafana-agent.yaml"
      - "-prometheus.wal-directory=/tmp"
    "image": "grafana/agent:v0.2.0"
    "ports":
      - "9091:9091"
    "volumes":
      - "./config:/etc/agent-config"
  "ingester-1":
    "build":
      "context": "."
      "dockerfile": "dev.dockerfile"
    "command":
      - "sh"
      - "-c"
      - "sleep 3 && exec ./cortex -config.file=./config/cortex.yaml -target=ingester -server.http-listen-port=8002 -server.grpc-listen-port=9002 "
    "depends_on":
      - "consul"
      - "minio"
    "environment":
      - "JAEGER_AGENT_HOST=jaeger"
      - "JAEGER_AGENT_PORT=6831"
      - "JAEGER_SAMPLER_PARAM=1"
      - "JAEGER_SAMPLER_TYPE=const"
      - "JAEGER_TAGS=app=ingester-1"
    "image": "cortex"
    "ports":
      - "8002:8002"
    "volumes":
      - "./config:/cortex/config"
      - ".data-ingester-1:/tmp/cortex-tsdb-ingester:delegated"
  "ingester-2":
    "build":
      "context": "."
      "dockerfile": "dev.dockerfile"
    "command":
      - "sh"
      - "-c"
      - "sleep 3 && exec ./cortex -config.file=./config/cortex.yaml -target=ingester -server.http-listen-port=8003 -server.grpc-listen-port=9003 "
    "depends_on":
      - "consul"
      - "minio"
    "environment":
      - "JAEGER_AGENT_HOST=jaeger"
      - "JAEGER_AGENT_PORT=6831"
      - "JAEGER_SAMPLER_PARAM=1"
      - "JAEGER_SAMPLER_TYPE=const"
      - "JAEGER_TAGS=app=ingester-2"
    "image": "cortex"
    "ports":
      - "8003:8003"
    "volumes":
      - "./config:/cortex/config"
      - ".data-ingester-2:/tmp/cortex-tsdb-ingester:delegated"
  "jaeger":
    "image": "jaegertracing/all-in-one"
    "ports":
      - "16686:16686"
      - "14268"
  "memcached":
    "image": "memcached:1.6"
  "minio":
    "command":
      - "server"
      - "/data"
    "environment":
      - "MINIO_ACCESS_KEY=cortex"
      - "MINIO_SECRET_KEY=supersecret"
    "image": "minio/minio"
    "ports":
      - "9000:9000"
    "volumes":
      - ".data-minio:/data:delegated"
  "prometheus":
    "command":
      - "--config.file=/etc/prometheus/prometheus.yaml"
    "image": "prom/prometheus:v2.16.0"
    "ports":
      - "9090:9090"
    "volumes":
      - "./config:/etc/prometheus"
  "purger":
    "build":
      "context": "."
      "dockerfile": "dev.dockerfile"
    "command":
      - "sh"
      - "-c"
      - "sleep 3 && exec ./cortex -config.file=./config/cortex.yaml -target=purger -server.http-listen-port=8014 -server.grpc-listen-port=9014 "
    "depends_on":
      - "consul"
      - "minio"
    "environment":
      - "JAEGER_AGENT_HOST=jaeger"
      - "JAEGER_AGENT_PORT=6831"
      - "JAEGER_SAMPLER_PARAM=1"
      - "JAEGER_SAMPLER_TYPE=const"
      - "JAEGER_TAGS=app=purger"
    "image": "cortex"
    "ports":
      - "8014:8014"
    "volumes":
      - "./config:/cortex/config"
  "querier":
    "build":
      "context": "."
      "dockerfile": "dev.dockerfile"
    "command":
      - "sh"
      - "-c"
      - "sleep 3 && exec ./cortex -config.file=./config/cortex.yaml -target=querier -server.http-listen-port=8004 -server.grpc-listen-port=9004 "
    "depends_on":
      - "consul"
      - "minio"
    "environment":
      - "JAEGER_AGENT_HOST=jaeger"
      - "JAEGER_AGENT_PORT=6831"
      - "JAEGER_SAMPLER_PARAM=1"
      - "JAEGER_SAMPLER_TYPE=const"
      - "JAEGER_TAGS=app=querier"
    "image": "cortex"
    "ports":
      - "8004:8004"
    "volumes":
      - "./config:/cortex/config"
  "querier-with-scheduler":
    "build":
      "context": "."
      "dockerfile": "dev.dockerfile"
    "command":
      - "sh"
      - "-c"
      - "sleep 3 && exec ./cortex -config.file=./config/cortex.yaml -target=querier -server.http-listen-port=8013 -server.grpc-listen-port=9013 -querier.scheduler-address=query-scheduler:9011 -querier.frontend-address="
    "depends_on":
      - "consul"
      - "minio"
    "environment":
      - "JAEGER_AGENT_HOST=jaeger"
      - "JAEGER_AGENT_PORT=6831"
      - "JAEGER_SAMPLER_PARAM=1"
      - "JAEGER_SAMPLER_TYPE=const"
      - "JAEGER_TAGS=app=querier-with-scheduler"
    "image": "cortex"
    "ports":
      - "8013:8013"
    "volumes":
      - "./config:/cortex/config"
  "query-frontend":
    "build":
      "context": "."
      "dockerfile": "dev.dockerfile"
    "command":
      - "sh"
      - "-c"
      - "sleep 3 && exec ./cortex -config.file=./config/cortex.yaml -target=query-frontend -server.http-listen-port=8007 -server.grpc-listen-port=9007 -store.max-query-length=8760h"
    "depends_on":
      - "consul"
      - "minio"
    "environment":
      - "JAEGER_AGENT_HOST=jaeger"
      - "JAEGER_AGENT_PORT=6831"
      - "JAEGER_SAMPLER_PARAM=1"
      - "JAEGER_SAMPLER_TYPE=const"
      - "JAEGER_TAGS=app=query-frontend"
    "image": "cortex"
    "ports":
      - "8007:8007"
    "volumes":
      - "./config:/cortex/config"
  "query-frontend-with-scheduler":
    "build":
      "context": "."
      "dockerfile": "dev.dockerfile"
    "command":
      - "sh"
      - "-c"
      - "sleep 3 && exec ./cortex -config.file=./config/cortex.yaml -target=query-frontend -server.http-listen-port=8012 -server.grpc-listen-port=9012 -store.max-query-length=8760h -frontend.scheduler-address=query-scheduler:9011"
    "depends_on":
      - "consul"
      - "minio"
    "environment":
      - "JAEGER_AGENT_HOST=jaeger"
      - "JAEGER_AGENT_PORT=6831"
      - "JAEGER_SAMPLER_PARAM=1"
      - "JAEGER_SAMPLER_TYPE=const"
      - "JAEGER_TAGS=app=query-frontend-with-scheduler"
    "image": "cortex"
    "ports":
      - "8012:8012"
    "volumes":
      - "./config:/cortex/config"
  "query-scheduler":
    "build":
      "context": "."
      "dockerfile": "dev.dockerfile"
    "command":
      - "sh"
      - "-c"
      - "sleep 3 && exec ./cortex -config.file=./config/cortex.yaml -target=query-scheduler -server.http-listen-port=8011 -server.grpc-listen-port=9011 -store.max-query-length=8760h"
    "depends_on":
      - "consul"
      - "minio"
    "environment":
      - "JAEGER_AGENT_HOST=jaeger"
      - "JAEGER_AGENT_PORT=6831"
      - "JAEGER_SAMPLER_PARAM=1"
      - "JAEGER_SAMPLER_TYPE=const"
      - "JAEGER_TAGS=app=query-scheduler"
    "image": "cortex"
    "ports":
      - "8011:8011"
    "volumes":
      - "./config:/cortex/config"
  "ruler-1":
    "build":
      "context": "."
      "dockerfile": "dev.dockerfile"
    "command":
      - "sh"
      - "-c"
      - "sleep 3 && exec ./cortex -config.file=./config/cortex.yaml -target=ruler -server.http-listen-port=8021 -server.grpc-listen-port=9021 "
    "depends_on":
      - "consul"
      - "minio"
    "environment":
      - "JAEGER_AGENT_HOST=jaeger"
      - "JAEGER_AGENT_PORT=6831"
      - "JAEGER_SAMPLER_PARAM=1"
      - "JAEGER_SAMPLER_TYPE=const"
      - "JAEGER_TAGS=app=ruler-1"
    "image": "cortex"
    "ports":
      - "8021:8021"
    "volumes":
      - "./config:/cortex/config"
  "ruler-2":
    "build":
      "context": "."
      "dockerfile": "dev.dockerfile"
    "command":
      - "sh"
      - "-c"
      - "sleep 3 && exec ./cortex -config.file=./config/cortex.yaml -target=ruler -server.http-listen-port=8022 -server.grpc-listen-port=9022 "
    "depends_on":
      - "consul"
      - "minio"
    "environment":
      - "JAEGER_AGENT_HOST=jaeger"
      - "JAEGER_AGENT_PORT=6831"
      - "JAEGER_SAMPLER_PARAM=1"
      - "JAEGER_SAMPLER_TYPE=const"
      - "JAEGER_TAGS=app=ruler-2"
    "image": "cortex"
    "ports":
      - "8022:8022"
    "volumes":
      - "./config:/cortex/config"
  "store-gateway-1":
    "build":
      "context": "."
      "dockerfile": "dev.dockerfile"
    "command":
      - "sh"
      - "-c"
      - "sleep 3 && exec ./cortex -config.file=./config/cortex.yaml -target=store-gateway -server.http-listen-port=8008 -server.grpc-listen-port=9008 "
    "depends_on":
      - "consul"
      - "minio"
    "environment":
      - "JAEGER_AGENT_HOST=jaeger"
      - "JAEGER_AGENT_PORT=6831"
      - "JAEGER_SAMPLER_PARAM=1"
      - "JAEGER_SAMPLER_TYPE=const"
      - "JAEGER_TAGS=app=store-gateway-1"
    "image": "cortex"
    "ports":
      - "8008:8008"
    "volumes":
      - "./config:/cortex/config"
  "store-gateway-2":
    "build":
      "context": "."
      "dockerfile": "dev.dockerfile"
    "command":
      - "sh"
      - "-c"
      - "sleep 3 && exec ./cortex -config.file=./config/cortex.yaml -target=store-gateway -server.http-listen-port=8009 -server.grpc-listen-port=9009 "
    "depends_on":
      - "consul"
      - "minio"
    "environment":
      - "JAEGER_AGENT_HOST=jaeger"
      - "JAEGER_AGENT_PORT=6831"
      - "JAEGER_SAMPLER_PARAM=1"
      - "JAEGER_SAMPLER_TYPE=const"
      - "JAEGER_TAGS=app=store-gateway-2"
    "image": "cortex"
    "ports":
      - "8009:8009"
    "volumes":
      - "./config:/cortex/config"
"version": "3.4"
