<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.101.0"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Compactor | Cortex</title><meta name=description content="
The compactor is an service which is responsible to:

Compact multiple blocks of a given tenant into a single optimized larger block. This helps to …</!-->"><meta property="og:title" content="Compactor"><meta property="og:description" content="The compactor is an service which is responsible to:
Compact multiple blocks of a given tenant into a single optimized larger block. This helps to reduce storage costs (deduplication, index size reduction), and increase query speed (querying fewer blocks is faster). Keep the per-tenant bucket index updated. The bucket index is used by queriers, store-gateways and rulers to discover new blocks in the storage. The compactor is stateless.
How compaction works The blocks compaction has two main benefits:"><meta property="og:type" content="article"><meta property="og:url" content="/docs/blocks-storage/compactor/"><meta property="og:image" content="/images/logo-twitter-card.jpg"><meta property="article:section" content="docs"><meta property="og:site_name" content="Cortex"><meta itemprop=name content="Compactor"><meta itemprop=description content="The compactor is an service which is responsible to:
Compact multiple blocks of a given tenant into a single optimized larger block. This helps to reduce storage costs (deduplication, index size reduction), and increase query speed (querying fewer blocks is faster). Keep the per-tenant bucket index updated. The bucket index is used by queriers, store-gateways and rulers to discover new blocks in the storage. The compactor is stateless.
How compaction works The blocks compaction has two main benefits:"><meta itemprop=wordCount content="2298"><meta itemprop=image content="/images/logo-twitter-card.jpg"><meta itemprop=keywords content><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/images/logo-twitter-card.jpg"><meta name=twitter:title content="Compactor"><meta name=twitter:description content="The compactor is an service which is responsible to:
Compact multiple blocks of a given tenant into a single optimized larger block. This helps to reduce storage costs (deduplication, index size reduction), and increase query speed (querying fewer blocks is faster). Keep the per-tenant bucket index updated. The bucket index is used by queriers, store-gateways and rulers to discover new blocks in the storage. The compactor is stateless.
How compaction works The blocks compaction has two main benefits:"><link rel=preload href=/scss/main.min.b2327889d9640582f368772c608732b32a6fa5b2b0c58b3d3c1d139029933f80.css as=style><link href=/scss/main.min.b2327889d9640582f368772c608732b32a6fa5b2b0c58b3d3c1d139029933f80.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SRR0DSREGX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SRR0DSREGX",{anonymize_ip:!1})}</script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar navbar-nocover"><a id=cortex-logo class=navbar-brand href=/><span class=navbar-logo><svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="-17.92 -14.92 1191.84 462.84"><defs><style>.cls-1{fill:#fff}</style></defs><path d="M214.531 8.017C99.353 8.017 5.65 101.72 5.65 216.899S99.353 425.78 214.531 425.78s208.882-93.704 208.882-208.882S329.71 8.017 214.531 8.017zm0 408.558c-110.102.0-199.676-89.574-199.676-199.676S104.429 17.222 214.53 17.222 414.208 106.797 414.208 216.9 324.633 416.575 214.53 416.575z" class="cls-1"/><circle cx="327.452" cy="221.633" r="34.571" class="cls-1"/><circle cx="213.713" cy="353.584" r="34.571" class="cls-1"/><path d="M299.992 167.913l-59-56.05a34.578 34.578.0 10-4.343 4.34l57.828 54.937a60.158 60.158.0 00-27.168 49.123h-12.97l-23.456-67.02-26.055 64.718H175.73l-24.724 57.22-21.808-54.524-.063.025v-.586h-22.048a34.582 34.582.0 10-.275 6.138h18.005l25.97 64.925 28.977-67.06h29.207l21.51-53.424 19.503 55.725H267.5a60.173 60.173.0 0025.202 44.11l-56.52 56.52 4.34 4.338 57.492-57.492a60.155 60.155.0 101.977-105.963zm81.481 53.515a54.02 54.02.0 11-54.022-54.02 54.083 54.083.0 0154.022 54.02zm175.707 42.568q-8.797 8.178-24.405 8.177a34.858 34.858.0 01-17.095-3.965 33.188 33.188.0 01-11.643-10.529 46.374 46.374.0 01-6.566-14.99 71.134 71.134.0 01-2.105-17.341 86.99 86.99.0 011.982-18.706 46.804 46.804.0 016.565-15.98 34.028 34.028.0 0112.263-11.149q7.675-4.21 19.077-4.212 13.38.0 21.306 6.69 7.927 6.689 10.405 18.829h21.803a50.76 50.76.0 00-5.946-19.696 44.06 44.06.0 00-12.015-13.75 49.842 49.842.0 00-16.848-8.051 77.44 77.44.0 00-20.44-2.601q-15.114.0-26.509 5.326a52.935 52.935.0 00-18.952 14.617 62.165 62.165.0 00-11.273 21.8 94.013 94.013.0 00-3.717 26.883 86.195 86.195.0 003.84 26.386 57.783 57.783.0 0011.397 20.686 50.138 50.138.0 0018.829 13.38 66.766 66.766.0 0025.891 4.705q24.527.0 38.772-12.882 14.245-12.878 17.715-36.668h-21.556q-1.986 14.867-10.776 23.041zm157.44-87.828a56.338 56.338.0 00-19.447-14.244q-11.52-5.203-26.882-5.203-15.115.0-26.756 5.203a56.009 56.009.0 00-19.573 14.244 59.75 59.75.0 00-11.892 21.307 85.299 85.299.0 00-3.965 26.386 84.117 84.117.0 003.965 26.262 59.853 59.853.0 0011.892 21.183 54.61 54.61.0 0019.573 14.12q11.643 5.077 26.756 5.08 15.36.0 26.882-5.08a54.908 54.908.0 0019.447-14.12 59.95 59.95.0 0011.892-21.183 84.181 84.181.0 003.965-26.262 85.364 85.364.0 00-3.965-26.386 59.846 59.846.0 00-11.892-21.307zm-9.538 68.38a43.305 43.305.0 01-8.548 15.113 37.061 37.061.0 01-12.759 9.29 38.825 38.825.0 01-30.968.0 37.003 37.003.0 01-12.76-9.29 43.209 43.209.0 01-8.547-15.114 70.669 70.669.0 010-41.373 44.634 44.634.0 018.547-15.237 36.428 36.428.0 0112.76-9.415 38.826 38.826.0 0130.968.0 36.484 36.484.0 0112.76 9.415 44.735 44.735.0 018.547 15.237 70.624 70.624.0 010 41.373zm81.141-80.89q-11.147 7.434-18.83 23.041h-.493v-27.005h-19.82V287.78h21.057v-56.984a87.528 87.528.0 012.478-21.924 41.993 41.993.0 017.93-16.228 33.951 33.951.0 0114.368-10.158q8.919-3.468 21.555-3.468V156.72q-17.097-.493-28.245 6.937zm80.761-42.366h-21.06v38.402h-21.8v18.581h21.8v81.51a48.668 48.668.0 001.734 14.37 17.432 17.432.0 005.326 8.423 20.57 20.57.0 009.415 4.088 75.59 75.59.0 0013.999 1.115h16.104v-18.582h-9.664a70.335 70.335.0 01-8.05-.37 10.361 10.361.0 01-4.833-1.611 6.108 6.108.0 01-2.354-3.469 23.006 23.006.0 01-.617-5.946v-79.528h25.518v-18.581h-25.518zm148.522 60.452a56.135 56.135.0 00-18.085-17.962q-11.276-7.063-28.367-7.06a58.263 58.263.0 00-24.155 4.953A56.796 56.796.0 00925.82 175.55a63.949 63.949.0 00-12.51 21.058 77.064 77.064.0 00-4.461 26.758 102.521 102.521.0 004.338 27.004 58.87 58.87.0 0011.519 21.307 52.43 52.43.0 0018.953 13.873q11.272 4.954 26.632 4.955 21.8.0 36.173-10.901 14.364-10.898 18.58-32.455h-20.81q-2.73 12.635-11.272 18.829-8.549 6.198-21.927 6.195a43.577 43.577.0 01-18.085-3.468 35.417 35.417.0 01-12.636-9.291 36.127 36.127.0 01-7.184-13.38 50.746 50.746.0 01-1.981-15.98h95.879a102.07 102.07.0 00-2.107-24.526 71.064 71.064.0 00-9.415-23.784zm-84.357 29.73a43.81 43.81.0 013.219-13.999 37.354 37.354.0 017.433-11.52 34.013 34.013.0 0111.272-7.803 36.694 36.694.0 0114.74-2.85 36.062 36.062.0 0114.494 2.85 36.492 36.492.0 0111.398 7.68 36.107 36.107.0 017.68 11.52 43.253 43.253.0 013.345 14.122zm170.95 7.184 44.1-58.964h-25.271l-31.961 44.843-30.721-44.843h-27.006l44.595 60.698-48.063 67.389h25.518l35.677-53.019 35.676 53.019h27.006l-49.55-69.123z" class="cls-1"/></svg></span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/><span class=active>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/blog/><span>Blog</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a href=https://twitter.com/cortexmetrics class="nav-link active"><span class=active><i class="fab fa-fw fa-twitter"></i> Twitter</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a href=https://github.com/cortexproject class="nav-link active"><span class=active><i class="fab fa-fw fa-github"></i> GitHub</span></a></li></ul></div><div class="navbar-nav d-none d-md-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.89a3f1b2a182586d990f2f853eae3469.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.89a3f1b2a182586d990f2f853eae3469.json data-offline-search-base-href=/ data-offline-search-max-results=10>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docs-li><a href=/docs/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-docs><span>Documentation</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsgetting-started-li><a href=/docs/getting-started/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsgetting-started><span>Getting Started</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsarchitecture-li><a href=/docs/architecture/ title="Cortex Architecture" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsarchitecture><span>Architecture</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docsblocks-storage-li><a href=/docs/blocks-storage/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsblocks-storage><span>Blocks Storage</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsblocks-storagequerier-li><a href=/docs/blocks-storage/querier/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storagequerier><span>Querier</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsblocks-storagestore-gateway-li><a href=/docs/blocks-storage/store-gateway/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storagestore-gateway><span>Store-gateway</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-docsblocks-storagecompactor-li><a href=/docs/blocks-storage/compactor/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storagecompactor><span class=td-sidebar-nav-active-item>Compactor</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsblocks-storageproduction-tips-li><a href=/docs/blocks-storage/production-tips/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storageproduction-tips><span>Production tips</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsblocks-storagebinary-index-header-li><a href=/docs/blocks-storage/binary-index-header/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storagebinary-index-header><span>Binary index-header</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsblocks-storagebucket-index-li><a href=/docs/blocks-storage/bucket-index/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storagebucket-index><span>Bucket Index</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsblocks-storagemigrate-cortex-cluster-from-chunks-to-blocks-li><a href=/docs/blocks-storage/migrate-cortex-cluster-from-chunks-to-blocks/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storagemigrate-cortex-cluster-from-chunks-to-blocks><span>Migrate Cortex cluster from chunks to blocks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsblocks-storageconvert-long-term-storage-from-chunks-to-blocks-li><a href=/docs/blocks-storage/convert-long-term-storage-from-chunks-to-blocks/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storageconvert-long-term-storage-from-chunks-to-blocks><span>Convert long-term storage from chunks to blocks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsblocks-storagemigrate-storage-from-thanos-and-prometheus-li><a href=/docs/blocks-storage/migrate-storage-from-thanos-and-prometheus/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storagemigrate-storage-from-thanos-and-prometheus><span>Migrate the storage from Thanos and Prometheus</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsblocks-storagelearn-more-li><a href=/docs/blocks-storage/learn-more/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storagelearn-more><span>Learn more</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsconfiguration-li><a href=/docs/configuration/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsconfiguration><span>Configuration</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsconfigurationconfiguration-file-li><a href=/docs/configuration/configuration-file/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsconfigurationconfiguration-file><span>Configuration file</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsconfigurationarguments-li><a href=/docs/configuration/arguments/ title="Cortex Arguments" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsconfigurationarguments><span>Cortex Arguments Explained</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsconfigurationprometheus-frontend-li><a href=/docs/configuration/prometheus-frontend/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsconfigurationprometheus-frontend><span>Prometheus Frontend</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsconfigurationv1guarantees-li><a href=/docs/configuration/v1guarantees/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsconfigurationv1guarantees><span>v1.x Guarantees</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsguides-li><a href=/docs/guides/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsguides><span>Guides</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesrunning-cortex-on-kubernetes-li><a href=/docs/guides/running-cortex-on-kubernetes/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesrunning-cortex-on-kubernetes><span>Running Cortex on Kubernetes</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesgetting-started-with-gossiped-ring-li><a href=/docs/guides/getting-started-with-gossiped-ring/ title="Getting started with gossiped ring" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesgetting-started-with-gossiped-ring><span>Getting started with a gossip ring cluster</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesalertmanager-configuration-li><a href=/docs/guides/alertmanager-configuration/ title="Configuring Notification using Cortex Alertmanager" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesalertmanager-configuration><span>Alertmanager configuration</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesauth-li><a href=/docs/guides/auth/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesauth><span>Authentication and Authorisation</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidescapacity-planning-li><a href=/docs/guides/capacity-planning/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidescapacity-planning><span>Capacity Planning</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesruler-sharding-li><a href=/docs/guides/ruler-sharding/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesruler-sharding><span>Config for horizontally scaling the Ruler</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesha-pair-handling-li><a href=/docs/guides/ha-pair-handling/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesha-pair-handling><span>Config for sending HA Pairs data to Cortex</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesencryption-at-rest-li><a href=/docs/guides/encryption-at-rest/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesencryption-at-rest><span>Encryption at Rest</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesingesters-rolling-updates-li><a href=/docs/guides/ingesters-rolling-updates/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesingesters-rolling-updates><span>Ingesters rolling updates</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesingesters-scaling-up-and-down-li><a href=/docs/guides/ingesters-scaling-up-and-down/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesingesters-scaling-up-and-down><span>Ingesters scaling up and down</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesnative-histograms-li><a href=/docs/guides/native-histograms/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesnative-histograms><span>Native Histograms</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesopentelemetry-collector-li><a href=/docs/guides/opentelemetry-collector/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesopentelemetry-collector><span>OpenTelemetry Collector</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesoverrides-exporter-li><a href=/docs/guides/overrides-exporter/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesoverrides-exporter><span>Overrides Exporter</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidespartition-compaction-li><a href=/docs/guides/partition-compaction/ title="Use Partition Compaction in Cortex" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidespartition-compaction><span>Partition Compaction</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesrule-evalutions-via-query-frontend-li><a href=/docs/guides/rule-evalutions-via-query-frontend/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesrule-evalutions-via-query-frontend><span>Rule evaluations via query frontend</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidestls-li><a href=/docs/guides/tls/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidestls><span>Securing communication between Cortex components with TLS</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidessecurity-li><a href=/docs/guides/security/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidessecurity><span>Security</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesshuffle-sharding-li><a href=/docs/guides/shuffle-sharding/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesshuffle-sharding><span>Shuffle Sharding</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidestracing-li><a href=/docs/guides/tracing/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidestracing><span>Tracing</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguideszone-aware-replication-li><a href=/docs/guides/zone-aware-replication/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguideszone-aware-replication><span>Zone Aware Replication</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesprotecting-cortex-from-heavy-queries-li><a href=/docs/guides/protecting-cortex-from-heavy-queries/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesprotecting-cortex-from-heavy-queries><span>Protecting Cortex from Heavy Queries</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguideslimitations-li><a href=/docs/guides/limitations/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguideslimitations><span>Limitations</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesglossary-li><a href=/docs/guides/glossary/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesglossary><span>Glossary</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsapi-li><a href=/docs/api/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsapi><span>HTTP API</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsoperations-li><a href=/docs/operations/ title="Operating Cortex" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsoperations><span>Operations</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsoperationsquery-auditor-li><a href=/docs/operations/query-auditor/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsoperationsquery-auditor><span>Query Auditor (tool)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsoperationsquery-tee-li><a href=/docs/operations/query-tee/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsoperationsquery-tee><span>Query Tee (service)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsoperationsrequests-mirroring-to-secondary-cluster-li><a href=/docs/operations/requests-mirroring-to-secondary-cluster/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsoperationsrequests-mirroring-to-secondary-cluster><span>Requests mirroring to secondary cluster</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsoperationsscaling-query-frontend-li><a href=/docs/operations/scaling-query-frontend/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsoperationsscaling-query-frontend><span>Scaling the Query Frontend</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docscase-studies-li><a href=/docs/case-studies/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docscase-studies><span>Case Studies</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscase-studiesgojek-li><a href=/docs/case-studies/gojek/ title="How Gojek Is Leveraging Cortex to Keep Up with Its Ever-Growing Scale" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscase-studiesgojek><span>Gojek</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscase-studiesrewe-digital-li><a href=/docs/case-studies/rewe-digital/ title="How Cortex helped REWE digital ensure stability while scaling services during the Covid-19 pandemic" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscase-studiesrewe-digital><span>REWE digital</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscase-studiesbuoyant-cloud-li><a href=/docs/case-studies/buoyant-cloud/ title="Buoyant Cloud and Cortex: Standing on the shoulders of Linkerd and Prometheus" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscase-studiesbuoyant-cloud><span>Buoyant Cloud</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsproposals-li><a href=/docs/proposals/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsproposals><span>Proposals</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsproposalsauth-gateway-li><a href=/docs/proposals/auth-gateway/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsauth-gateway><span>Authentication Gateway</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsproposalsblocks-storage-bucket-index-li><a href=/docs/proposals/blocks-storage-bucket-index/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsblocks-storage-bucket-index><span>Blocks storage bucket index</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsproposalsblocks-storage-sharding-li><a href=/docs/proposals/blocks-storage-sharding/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsblocks-storage-sharding><span>Blocks storage sharding</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsproposalscross-tenant-query-federation-li><a href=/docs/proposals/cross-tenant-query-federation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalscross-tenant-query-federation><span>Cross-Tenant Query Federation</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsproposalstenant-deletion-li><a href=/docs/proposals/tenant-deletion/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalstenant-deletion><span>Deletion of Tenant Data from Blocks Storage</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsproposalsdocumentation-versioning-li><a href=/docs/proposals/documentation-versioning/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsdocumentation-versioning><span>Documentation Versioning</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsproposalsgeneralize-modules-li><a href=/docs/proposals/generalize-modules/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsgeneralize-modules><span>Generalize Modules Service to make it extensible</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsproposalshttp-api-design-li><a href=/docs/proposals/http-api-design/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalshttp-api-design><span>HTTP API Design</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsproposalsingesters-migration-li><a href=/docs/proposals/ingesters-migration/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsingesters-migration><span>Migrating ingesters from chunks to blocks and back.</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsproposalsparallel-compaction-li><a href=/docs/proposals/parallel-compaction/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsparallel-compaction><span>Parallel Compaction by Time Interval</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsproposalsparquet-storage-li><a href=/docs/proposals/parquet-storage/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsparquet-storage><span>Parquet-based Storage</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsproposalstenant-retention-li><a href=/docs/proposals/tenant-retention/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalstenant-retention><span>Retention of Tenant Data from Blocks Storage</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsproposalsring-multikey-li><a href=/docs/proposals/ring-multikey/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsring-multikey><span>Ring Multikey</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsproposalsruler-ha-li><a href=/docs/proposals/ruler-ha/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsruler-ha><span>Ruler HA</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsproposalsruler-high-availability-li><a href=/docs/proposals/ruler-high-availability/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsruler-high-availability><span>Ruler High Availability</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsproposalsruler-tenant-federation-li><a href=/docs/proposals/ruler-tenant-federation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsruler-tenant-federation><span>Ruler Tenant Federation</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsproposalsscalable-alertmanager-li><a href=/docs/proposals/scalable-alertmanager/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsscalable-alertmanager><span>Scalable Alertmanager</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsproposalsscalable-query-frontend-li><a href=/docs/proposals/scalable-query-frontend/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsscalable-query-frontend><span>Scalable Query Frontend</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsproposalsshuffle-sharding-and-zone-awareness-li><a href=/docs/proposals/shuffle-sharding-and-zone-awareness/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsshuffle-sharding-and-zone-awareness><span>Shuffle sharding and zone awareness</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsproposalsshuffle-sharding-on-the-read-path-li><a href=/docs/proposals/shuffle-sharding-on-the-read-path/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsshuffle-sharding-on-the-read-path><span>Shuffle sharding on the read path</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsproposalssupport-metadata-api-li><a href=/docs/proposals/support-metadata-api/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalssupport-metadata-api><span>Support metadata API</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsproposalsblock-storage-time-series-deletion-li><a href=/docs/proposals/block-storage-time-series-deletion/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsblock-storage-time-series-deletion><span>Time Series Deletion from Blocks Storage</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsproposalstimeseries-partitioning-in-compactor-li><a href=/docs/proposals/timeseries-partitioning-in-compactor/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalstimeseries-partitioning-in-compactor><span>Timeseries Partitioning in Compactor</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docscontributing-li><a href=/docs/contributing/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docscontributing><span>Contributing</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscontributinggovernance-li><a href=/docs/contributing/governance/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscontributinggovernance><span>Governance</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscontributingdesign-patterns-and-code-conventions-li><a href=/docs/contributing/design-patterns-and-code-conventions/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscontributingdesign-patterns-and-code-conventions><span>Design patterns and Code conventions</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscontributinghow-to-run-the-website-locally-li><a href=/docs/contributing/how-to-run-the-website-locally/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscontributinghow-to-run-the-website-locally><span>How to run the website locally</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscontributinghow-to-upgrade-golang-version-li><a href=/docs/contributing/how-to-upgrade-golang-version/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscontributinghow-to-upgrade-golang-version><span>How to upgrade Golang version</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscontributinghow-integration-tests-work-li><a href=/docs/contributing/how-integration-tests-work/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscontributinghow-integration-tests-work><span>How integration tests work</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscontributinghow-to-update-the-build-image-li><a href=/docs/contributing/how-to-update-the-build-image/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscontributinghow-to-update-the-build-image><span>How to update the build image</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscontributinghow-to-add-a-maintainer-li><a href=/docs/contributing/how-to-add-a-maintainer/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscontributinghow-to-add-a-maintainer><span>How to add a maintainer</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsroadmap-li><a href=/docs/roadmap/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsroadmap><span>Roadmap</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docschangelog-li><a href=/docs/changelog/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docschangelog><span>Changelog</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscode-of-conduct-li><a href=/docs/code-of-conduct/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscode-of-conduct><span>Code of Conduct</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/cortexproject/cortex/edit/master/docs/blocks-storage/compactor.md target=_blank><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/cortexproject/cortex/issues/new?title=Compactor" target=_blank><i class="fab fa-github fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/cortexproject/cortex/issues/new target=_blank><i class="fas fa-tasks fa-fw"></i> Create project issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#how-compaction-works>How compaction works</a></li><li><a href=#compactor-sharding>Compactor sharding</a><ul><li><a href=#waiting-for-stable-ring-at-startup>Waiting for stable ring at startup</a></li></ul></li><li><a href=#soft-and-hard-blocks-deletion>Soft and hard blocks deletion</a></li><li><a href=#compactor-disk-utilization>Compactor disk utilization</a></li><li><a href=#compactor-http-endpoints>Compactor HTTP endpoints</a></li><li><a href=#compactor-configuration>Compactor configuration</a><ul><li><a href=#compactor_config><code>compactor_config</code></a></li></ul></li></ul></nav></div><div class="taxonomy taxonomy-terms-cloud taxo-projects"><h5 class=taxonomy-title>Our Projects</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=/projects/cortex/ data-taxonomy-term=cortex><span class=taxonomy-label>cortex</span><span class=taxonomy-count>1</span></a></li></ul></div><div class="taxonomy taxonomy-terms-cloud taxo-tags"><h5 class=taxonomy-title>Tag Cloud</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=/tags/blog/ data-taxonomy-term=blog><span class=taxonomy-label>blog</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/community/ data-taxonomy-term=community><span class=taxonomy-label>community</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/cortex/ data-taxonomy-term=cortex><span class=taxonomy-label>cortex</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/updates/ data-taxonomy-term=updates><span class=taxonomy-label>updates</span><span class=taxonomy-count>1</span></a></li></ul></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/docs/>Documentation</a></li><li class=breadcrumb-item><a href=/docs/blocks-storage/>Blocks Storage</a></li><li class="breadcrumb-item active" aria-current=page><a href=/docs/blocks-storage/compactor/ aria-disabled=true class="btn-link disabled">Compactor</a></li></ol></nav><div class=td-content><h1>Compactor</h1><header class=article-meta></header><p>The <strong>compactor</strong> is an service which is responsible to:</p><ul><li>Compact multiple blocks of a given tenant into a single optimized larger block. This helps to reduce storage costs (deduplication, index size reduction), and increase query speed (querying fewer blocks is faster).</li><li>Keep the per-tenant bucket index updated. The <a href=/docs/blocks-storage/bucket-index/>bucket index</a> is used by <a href=/docs/blocks-storage/querier/>queriers</a>, <a href=/docs/blocks-storage/store-gateway/>store-gateways</a> and rulers to discover new blocks in the storage.</li></ul><p>The compactor is <strong>stateless</strong>.</p><h2 id=how-compaction-works>How compaction works</h2><p>The blocks compaction has two main benefits:</p><ol><li>Vertically compact blocks uploaded by all ingesters for the same time range</li><li>Horizontally compact blocks with small time ranges into a single larger block</li></ol><p>The <strong>vertical compaction</strong> merges all the blocks of a tenant uploaded by ingesters for the same time range (2 hours ranges by default) into a single block, while <strong>de-duplicating samples</strong> that are originally written to N blocks as a result of replication. This step reduces number of blocks for single 2 hours time range from #(number of ingesters) to 1 per tenant.</p><p>The <strong>horizontal compaction</strong> triggers after the vertical compaction and compacts several blocks with adjacent 2-hour range periods into a single larger block. Even though the total size of block chunks doesn&rsquo;t change after this compaction, it may still significantly reduce the size of the index and the index-header kept in memory by store-gateways.</p><p><img src=/images/blocks-storage/compactor-horizontal-and-vertical-compaction.png alt="Compactor - horizontal and vertical compaction"></p><h2 id=compactor-sharding>Compactor sharding</h2><p>The compactor optionally supports sharding.</p><p>When sharding is enabled, multiple compactor instances can coordinate to split the workload and shard blocks by tenant. All the blocks of a tenant are processed by a single compactor instance at any given time, but compaction for different tenants may simultaneously run on different compactor instances.</p><p>Whenever the pool of compactors increase or decrease (ie. following up a scale up/down), tenants are resharded across the available compactor instances without any manual intervention.</p><p>The compactor sharding is based on the Cortex <a href=/docs/architecture/#the-hash-ring>hash ring</a>. At startup, a compactor generates random tokens and registers itself to the ring. While running, it periodically scans the storage bucket (every <code>-compactor.compaction-interval</code>) to discover the list of tenants in the storage and compacts blocks for each tenant whose hash matches the token ranges assigned to the instance itself within the ring.</p><p>This feature can be enabled via <code>-compactor.sharding-enabled=true</code> and requires the backend <a href=/docs/architecture/#the-hash-ring>hash ring</a> to be configured via <code>-compactor.ring.*</code> flags (or their respective YAML config options).</p><h3 id=waiting-for-stable-ring-at-startup>Waiting for stable ring at startup</h3><p>In the event of a cluster cold start or scale up of 2+ compactor instances at the same time we may end up in a situation where each new compactor instance starts at a slightly different time and thus each one runs the first compaction based on a different state of the ring. This is not a critical condition, but may be inefficient, because multiple compactor replicas may start compacting the same tenant nearly at the same time.</p><p>To reduce the likelihood this could happen, the compactor waits for a stable ring at startup. A ring is considered stable if no instance is added/removed to the ring for at least <code>-compactor.ring.wait-stability-min-duration</code>. If the ring keep getting changed after <code>-compactor.ring.wait-stability-max-duration</code>, the compactor will stop waiting for a stable ring and will proceed starting up normally.</p><p>To disable this waiting logic, you can start the compactor with <code>-compactor.ring.wait-stability-min-duration=0</code>.</p><h2 id=soft-and-hard-blocks-deletion>Soft and hard blocks deletion</h2><p>When the compactor successfully compacts some source blocks into a larger block, source blocks are deleted from the storage. Blocks deletion is not immediate, but follows a two steps process:</p><ol><li>First, a block is <strong>marked for deletion</strong> (soft delete)</li><li>Then, once a block is marked for deletion for longer then <code>-compactor.deletion-delay</code>, the block is <strong>deleted</strong> from the storage (hard delete)</li></ol><p>The compactor is both responsible to mark blocks for deletion and then hard delete them once the deletion delay expires.
The soft deletion is based on a tiny <code>deletion-mark.json</code> file stored within the block location in the bucket which gets looked up both by queriers and store-gateways.</p><p>This soft deletion mechanism is used to give enough time to queriers and store-gateways to discover the new compacted blocks before the old source blocks are deleted. If source blocks would be immediately hard deleted by the compactor, some queries involving the compacted blocks may fail until the queriers and store-gateways haven&rsquo;t rescanned the bucket and found both deleted source blocks and the new compacted ones.</p><h2 id=compactor-disk-utilization>Compactor disk utilization</h2><p>The compactor needs to download source blocks from the bucket to the local disk, and store the compacted block to the local disk before uploading it to the bucket. Depending on the largest tenants in your cluster and the configured <code>-compactor.block-ranges</code>, the compactor may need a lot of disk space.</p><p>Assuming <code>max_compaction_range_blocks_size</code> is the total size of blocks for the largest tenant (you can measure it inspecting the bucket) and the longest <code>-compactor.block-ranges</code> period, the formula to estimate the minimum disk space required is:</p><pre tabindex=0><code>min_disk_space_required = compactor.compaction-concurrency * max_compaction_range_blocks_size * 2
</code></pre><p>Alternatively, assuming the largest <code>-compactor.block-ranges</code> is <code>24h</code> (default), you could consider 150GB of disk space every 10M active series owned by the largest tenant. For example, if your largest tenant has 30M active series and <code>-compactor.compaction-concurrency=1</code> we would recommend having a disk with at least 450GB available.</p><h2 id=compactor-http-endpoints>Compactor HTTP endpoints</h2><ul><li><code>GET /compactor/ring</code><br>Displays the status of the compactors ring, including the tokens owned by each compactor and an option to remove (forget) instances from the ring.</li></ul><h2 id=compactor-configuration>Compactor configuration</h2><p>This section described the compactor configuration. For the general Cortex configuration and references to common config blocks, please refer to the <a href=/docs/configuration/configuration-file/>configuration documentation</a>.</p><h3 id=compactor_config><code>compactor_config</code></h3><p>The <code>compactor_config</code> configures the compactor for the blocks storage.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>compactor</span>:
</span></span><span style=display:flex><span>  <span style=color:#75715e># List of compaction time ranges.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.block-ranges</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[block_ranges</span>: <span style=color:#ae81ff>&lt;list of duration&gt; | default = 2h0m0s,12h0m0s,24h0m0s]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Number of Go routines to use when syncing block index and chunks files from</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># the long term storage.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.block-sync-concurrency</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[block_sync_concurrency</span>: <span style=color:#ae81ff>&lt;int&gt; | default = 20]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Number of Go routines to use when syncing block meta files from the long</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># term storage.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.meta-sync-concurrency</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[meta_sync_concurrency</span>: <span style=color:#ae81ff>&lt;int&gt; | default = 20]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Minimum age of fresh (non-compacted) blocks before they are being processed.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Malformed blocks older than the maximum of consistency-delay and 48h0m0s</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># will be removed.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.consistency-delay</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[consistency_delay</span>: <span style=color:#ae81ff>&lt;duration&gt; | default = 0s]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Data directory in which to cache blocks and process compactions</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.data-dir</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[data_dir</span>: <span style=color:#ae81ff>&lt;string&gt; | default = &#34;./data&#34;]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># The frequency at which the compaction runs</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.compaction-interval</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[compaction_interval</span>: <span style=color:#ae81ff>&lt;duration&gt; | default = 1h]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># How many times to retry a failed compaction within a single compaction run.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.compaction-retries</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[compaction_retries</span>: <span style=color:#ae81ff>&lt;int&gt; | default = 3]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Max number of concurrent compactions running.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.compaction-concurrency</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[compaction_concurrency</span>: <span style=color:#ae81ff>&lt;int&gt; | default = 1]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># How frequently compactor should run blocks cleanup and maintenance, as well</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># as update the bucket index.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.cleanup-interval</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[cleanup_interval</span>: <span style=color:#ae81ff>&lt;duration&gt; | default = 15m]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Max number of tenants for which blocks cleanup and maintenance should run</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># concurrently.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.cleanup-concurrency</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[cleanup_concurrency</span>: <span style=color:#ae81ff>&lt;int&gt; | default = 20]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Time before a block marked for deletion is deleted from bucket. If not 0,</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># blocks will be marked for deletion and compactor component will permanently</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># delete blocks marked for deletion from the bucket. If 0, blocks will be</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># deleted straight away. Note that deleting blocks immediately can cause query</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># failures.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.deletion-delay</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[deletion_delay</span>: <span style=color:#ae81ff>&lt;duration&gt; | default = 12h]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># For tenants marked for deletion, this is time between deleting of last</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># block, and doing final cleanup (marker files, debug files) of the tenant.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.tenant-cleanup-delay</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[tenant_cleanup_delay</span>: <span style=color:#ae81ff>&lt;duration&gt; | default = 6h]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># When enabled, mark blocks containing index with out-of-order chunks for no</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># compact instead of halting the compaction.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.skip-blocks-with-out-of-order-chunks-enabled</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[skip_blocks_with_out_of_order_chunks_enabled</span>: <span style=color:#ae81ff>&lt;boolean&gt; | default = false]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Number of goroutines to use when fetching/uploading block files from object</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># storage.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.block-files-concurrency</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[block_files_concurrency</span>: <span style=color:#ae81ff>&lt;int&gt; | default = 10]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Number of goroutines to use when fetching blocks from object storage when</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># compacting.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.blocks-fetch-concurrency</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[blocks_fetch_concurrency</span>: <span style=color:#ae81ff>&lt;int&gt; | default = 3]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># When enabled, at compactor startup the bucket will be scanned and all found</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># deletion marks inside the block location will be copied to the markers</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># global location too. This option can (and should) be safely disabled as soon</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># as the compactor has successfully run at least once.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.block-deletion-marks-migration-enabled</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[block_deletion_marks_migration_enabled</span>: <span style=color:#ae81ff>&lt;boolean&gt; | default = false]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Comma separated list of tenants that can be compacted. If specified, only</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># these tenants will be compacted by compactor, otherwise all tenants can be</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># compacted. Subject to sharding.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.enabled-tenants</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[enabled_tenants</span>: <span style=color:#ae81ff>&lt;string&gt; | default = &#34;&#34;]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Comma separated list of tenants that cannot be compacted by this compactor.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># If specified, and compactor would normally pick given tenant for compaction</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># (via -compactor.enabled-tenants or sharding), it will be ignored instead.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.disabled-tenants</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[disabled_tenants</span>: <span style=color:#ae81ff>&lt;string&gt; | default = &#34;&#34;]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># Shard tenants across multiple compactor instances. Sharding is required if</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># you run multiple compactor instances, in order to coordinate compactions and</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># avoid race conditions leading to the same tenant blocks simultaneously</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># compacted by different instances.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.sharding-enabled</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[sharding_enabled</span>: <span style=color:#ae81ff>&lt;boolean&gt; | default = false]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># The sharding strategy to use. Supported values are: default,</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># shuffle-sharding.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.sharding-strategy</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[sharding_strategy</span>: <span style=color:#ae81ff>&lt;string&gt; | default = &#34;default&#34;]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>sharding_ring</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>kvstore</span>:
</span></span><span style=display:flex><span>      <span style=color:#75715e># Backend storage to use for the ring. Supported values are: consul, etcd,</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># inmemory, memberlist, multi.</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># CLI flag: -compactor.ring.store</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>[store</span>: <span style=color:#ae81ff>&lt;string&gt; | default = &#34;consul&#34;]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># The prefix for the keys in the store. Should end with a /.</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># CLI flag: -compactor.ring.prefix</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>[prefix</span>: <span style=color:#ae81ff>&lt;string&gt; | default = &#34;collectors/&#34;]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>dynamodb</span>:
</span></span><span style=display:flex><span>        <span style=color:#75715e># Region to access dynamodb.</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># CLI flag: -compactor.ring.dynamodb.region</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>[region</span>: <span style=color:#ae81ff>&lt;string&gt; | default = &#34;&#34;]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Table name to use on dynamodb.</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># CLI flag: -compactor.ring.dynamodb.table-name</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>[table_name</span>: <span style=color:#ae81ff>&lt;string&gt; | default = &#34;&#34;]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Time to expire items on dynamodb.</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># CLI flag: -compactor.ring.dynamodb.ttl-time</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>[ttl</span>: <span style=color:#ae81ff>&lt;duration&gt; | default = 0s]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Time to refresh local ring with information on dynamodb.</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># CLI flag: -compactor.ring.dynamodb.puller-sync-time</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>[puller_sync_time</span>: <span style=color:#ae81ff>&lt;duration&gt; | default = 1m]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Maximum number of retries for DDB KV CAS.</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># CLI flag: -compactor.ring.dynamodb.max-cas-retries</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>[max_cas_retries</span>: <span style=color:#ae81ff>&lt;int&gt; | default = 10]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Timeout of dynamoDbClient requests. Default is 2m.</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># CLI flag: -compactor.ring.dynamodb.timeout</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>[timeout</span>: <span style=color:#ae81ff>&lt;duration&gt; | default = 2m]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># The consul_config configures the consul client.</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># The CLI flags prefix for this block config is: compactor.ring</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>[consul</span>: <span style=color:#ae81ff>&lt;consul_config&gt;]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># The etcd_config configures the etcd client.</span>
</span></span><span style=display:flex><span>      <span style=color:#75715e># The CLI flags prefix for this block config is: compactor.ring</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>[etcd</span>: <span style=color:#ae81ff>&lt;etcd_config&gt;]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>multi</span>:
</span></span><span style=display:flex><span>        <span style=color:#75715e># Primary backend storage used by multi-client.</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># CLI flag: -compactor.ring.multi.primary</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>[primary</span>: <span style=color:#ae81ff>&lt;string&gt; | default = &#34;&#34;]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Secondary backend storage used by multi-client.</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># CLI flag: -compactor.ring.multi.secondary</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>[secondary</span>: <span style=color:#ae81ff>&lt;string&gt; | default = &#34;&#34;]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Mirror writes to secondary store.</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># CLI flag: -compactor.ring.multi.mirror-enabled</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>[mirror_enabled</span>: <span style=color:#ae81ff>&lt;boolean&gt; | default = false]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># Timeout for storing value to secondary store.</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># CLI flag: -compactor.ring.multi.mirror-timeout</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>[mirror_timeout</span>: <span style=color:#ae81ff>&lt;duration&gt; | default = 2s]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Period at which to heartbeat to the ring. 0 = disabled.</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># CLI flag: -compactor.ring.heartbeat-period</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>[heartbeat_period</span>: <span style=color:#ae81ff>&lt;duration&gt; | default = 5s]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># The heartbeat timeout after which compactors are considered unhealthy</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># within the ring. 0 = never (timeout disabled).</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># CLI flag: -compactor.ring.heartbeat-timeout</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>[heartbeat_timeout</span>: <span style=color:#ae81ff>&lt;duration&gt; | default = 1m]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Time since last heartbeat before compactor will be removed from ring. 0 to</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># disable</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># CLI flag: -compactor.auto-forget-delay</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>[auto_forget_delay</span>: <span style=color:#ae81ff>&lt;duration&gt; | default = 2m]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Minimum time to wait for ring stability at startup. 0 to disable.</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># CLI flag: -compactor.ring.wait-stability-min-duration</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>[wait_stability_min_duration</span>: <span style=color:#ae81ff>&lt;duration&gt; | default = 1m]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Maximum time to wait for ring stability at startup. If the compactor ring</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># keeps changing after this period of time, the compactor will start anyway.</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># CLI flag: -compactor.ring.wait-stability-max-duration</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>[wait_stability_max_duration</span>: <span style=color:#ae81ff>&lt;duration&gt; | default = 5m]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Name of network interface to read address from.</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># CLI flag: -compactor.ring.instance-interface-names</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>[instance_interface_names</span>: <span style=color:#ae81ff>&lt;list of string&gt; | default = [eth0 en0]]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># File path where tokens are stored. If empty, tokens are not stored at</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># shutdown and restored at startup.</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># CLI flag: -compactor.ring.tokens-file-path</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>[tokens_file_path</span>: <span style=color:#ae81ff>&lt;string&gt; | default = &#34;&#34;]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Unregister the compactor during shutdown if true.</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># CLI flag: -compactor.ring.unregister-on-shutdown</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>[unregister_on_shutdown</span>: <span style=color:#ae81ff>&lt;boolean&gt; | default = true]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Timeout for waiting on compactor to become ACTIVE in the ring.</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># CLI flag: -compactor.ring.wait-active-instance-timeout</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>[wait_active_instance_timeout</span>: <span style=color:#ae81ff>&lt;duration&gt; | default = 10m]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># How long shuffle sharding planner would wait before running planning code.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># This delay would prevent double compaction when two compactors claimed same</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># partition in grouper at same time.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.sharding-planner-delay</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[sharding_planner_delay</span>: <span style=color:#ae81ff>&lt;duration&gt; | default = 10s]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># The compaction strategy to use. Supported values are: default, partitioning.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.compaction-strategy</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[compaction_strategy</span>: <span style=color:#ae81ff>&lt;string&gt; | default = &#34;default&#34;]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># How long compaction visit marker file should be considered as expired and</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># able to be picked up by compactor again.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.compaction-visit-marker-timeout</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[compaction_visit_marker_timeout</span>: <span style=color:#ae81ff>&lt;duration&gt; | default = 10m]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># How frequently compaction visit marker file should be updated duration</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># compaction.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.compaction-visit-marker-file-update-interval</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[compaction_visit_marker_file_update_interval</span>: <span style=color:#ae81ff>&lt;duration&gt; | default = 1m]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># How long cleaner visit marker file should be considered as expired and able</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># to be picked up by cleaner again. The value should be smaller than</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># -compactor.cleanup-interval</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.cleaner-visit-marker-timeout</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[cleaner_visit_marker_timeout</span>: <span style=color:#ae81ff>&lt;duration&gt; | default = 10m]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># How frequently cleaner visit marker file should be updated when cleaning</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># user.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.cleaner-visit-marker-file-update-interval</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[cleaner_visit_marker_file_update_interval</span>: <span style=color:#ae81ff>&lt;duration&gt; | default = 5m]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># When enabled, index verification will ignore out of order label names.</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.accept-malformed-index</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[accept_malformed_index</span>: <span style=color:#ae81ff>&lt;boolean&gt; | default = false]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># When enabled, caching bucket will be used for compactor, except cleaner</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># service, which serves as the source of truth for block status</span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># CLI flag: -compactor.caching-bucket-enabled</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>[caching_bucket_enabled</span>: <span style=color:#ae81ff>&lt;boolean&gt; | default = false]</span>
</span></span></code></pre></div></div></main></div></div><footer><div class="row td-box td-box--dark td-box--gradient td-box--height-auto text-white p-5"><div class="col-12 col-sm-4 pb-5 pb-sm-0"><img src=/images/cortex-stacked-white.png width=75px class="img-fluid float-left"></div><div class="col-12 col-sm-4 pb-5 pb-sm-0"><h6 class=font-weight-bold>Community</h6><ul class=list-unstyled><li><a href=https://slack.cncf.io class="text-reset text-white"><i class="fab fa-fw fa-slack"></i> Slack</a></li><li><a href=https://github.com/cortexproject/cortex class="text-reset text-white"><i class="fab fa-fw fa-github"></i> GitHub</a></li><li><a href=https://twitter.com/cortexmetrics class="text-reset text-white"><i class="fab fa-fw fa-twitter"></i> Twitter</a></li></ul></div><div class="col-12 col-sm-4"><h6 class=font-weight-bold>About</h6><p>Cortex is an OSS licensed project as Apache License 2.0</p></div></div><div class="row td-box td-box--dark td-box--gradient td-box--height-auto text-white p-5 text-center"><small class="col-12 text-center">© 2025 The Cortex Authors All Rights Reserved.<br>The Linux Foundation has registered trademarks and uses trademarks.
For a list of trademarks of The Linux Foundation, please see <a class="text-light alert-link" href=https://www.linuxfoundation.org/trademark-usage>Trademark Usage page</a>.</small></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.91798a335c881f1b6b805085ba4aa22d1dbd2b0b18d105d05189fa104ddae350.js integrity="sha256-kXmKM1yIHxtrgFCFukqiLR29KwsY0QXQUYn6EE3a41A=" crossorigin=anonymous></script></body></html>