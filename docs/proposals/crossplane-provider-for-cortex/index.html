<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.101.0"><meta name=robots content="index, follow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Crossplane Provider for Cortex | Cortex</title><meta name=description content="
Author: Alex Frisvold
Date: 10/1/2025
Status: Proposed

Overview
This proposal outlines the development of a Crossplane provider for Cortex that …"><meta property="og:title" content="Crossplane Provider for Cortex"><meta property="og:description" content="Author: Alex Frisvold Date: 10/1/2025 Status: Proposed Overview This proposal outlines the development of a Crossplane provider for Cortex that enables declarative management of a Cortex tenant&rsquo;s recording rules, alerting rules, and Alertmanager configurations through Kubernetes Custom Resources.
Current State Currently, a Cortex tenant&rsquo;s recording rules, alerting rules, and Alertmanager configurations are managed through a variety of methods:
Manual API calls to configure alerting rules and alertmanager settings cortextool CLI that directly interacts with Cortex APIs Configuration files deployed via traditional Kubernetes deployments or ConfigMaps This approach leads to several challenges:"><meta property="og:type" content="article"><meta property="og:url" content="/docs/proposals/crossplane-provider-for-cortex/"><meta property="og:image" content="/images/logo-twitter-card.jpg"><meta property="article:section" content="docs"><meta property="og:site_name" content="Cortex"><meta itemprop=name content="Crossplane Provider for Cortex"><meta itemprop=description content="Author: Alex Frisvold Date: 10/1/2025 Status: Proposed Overview This proposal outlines the development of a Crossplane provider for Cortex that enables declarative management of a Cortex tenant&rsquo;s recording rules, alerting rules, and Alertmanager configurations through Kubernetes Custom Resources.
Current State Currently, a Cortex tenant&rsquo;s recording rules, alerting rules, and Alertmanager configurations are managed through a variety of methods:
Manual API calls to configure alerting rules and alertmanager settings cortextool CLI that directly interacts with Cortex APIs Configuration files deployed via traditional Kubernetes deployments or ConfigMaps This approach leads to several challenges:"><meta itemprop=wordCount content="2269"><meta itemprop=image content="/images/logo-twitter-card.jpg"><meta itemprop=keywords content><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/images/logo-twitter-card.jpg"><meta name=twitter:title content="Crossplane Provider for Cortex"><meta name=twitter:description content="Author: Alex Frisvold Date: 10/1/2025 Status: Proposed Overview This proposal outlines the development of a Crossplane provider for Cortex that enables declarative management of a Cortex tenant&rsquo;s recording rules, alerting rules, and Alertmanager configurations through Kubernetes Custom Resources.
Current State Currently, a Cortex tenant&rsquo;s recording rules, alerting rules, and Alertmanager configurations are managed through a variety of methods:
Manual API calls to configure alerting rules and alertmanager settings cortextool CLI that directly interacts with Cortex APIs Configuration files deployed via traditional Kubernetes deployments or ConfigMaps This approach leads to several challenges:"><link rel=preload href=/scss/main.min.5eaade7cd2a503d4fabeefa845c4a82ed6faa89fe4c763572d9fbdd72b72312d.css as=style><link href=/scss/main.min.5eaade7cd2a503d4fabeefa845c4a82ed6faa89fe4c763572d9fbdd72b72312d.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script defer src=https://unpkg.com/lunr@2.3.9/lunr.min.js integrity=sha384-203J0SNzyqHby3iU6hzvzltrWi/M41wOP5Gu+BiJMz5nwKykbkUx8Kp7iti0Lpli crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-SRR0DSREGX"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SRR0DSREGX",{anonymize_ip:!1})}</script></head><body class=td-page><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar navbar-nocover"><a id=cortex-logo class=navbar-brand href=/><span class=navbar-logo><svg xmlns="http://www.w3.org/2000/svg" role="img" viewBox="-17.92 -14.92 1191.84 462.84"><defs><style>.cls-1{fill:#fff}</style></defs><path d="M214.531 8.017C99.353 8.017 5.65 101.72 5.65 216.899S99.353 425.78 214.531 425.78s208.882-93.704 208.882-208.882S329.71 8.017 214.531 8.017zm0 408.558c-110.102.0-199.676-89.574-199.676-199.676S104.429 17.222 214.53 17.222 414.208 106.797 414.208 216.9 324.633 416.575 214.53 416.575z" class="cls-1"/><circle cx="327.452" cy="221.633" r="34.571" class="cls-1"/><circle cx="213.713" cy="353.584" r="34.571" class="cls-1"/><path d="M299.992 167.913l-59-56.05a34.578 34.578.0 10-4.343 4.34l57.828 54.937a60.158 60.158.0 00-27.168 49.123h-12.97l-23.456-67.02-26.055 64.718H175.73l-24.724 57.22-21.808-54.524-.063.025v-.586h-22.048a34.582 34.582.0 10-.275 6.138h18.005l25.97 64.925 28.977-67.06h29.207l21.51-53.424 19.503 55.725H267.5a60.173 60.173.0 0025.202 44.11l-56.52 56.52 4.34 4.338 57.492-57.492a60.155 60.155.0 101.977-105.963zm81.481 53.515a54.02 54.02.0 11-54.022-54.02 54.083 54.083.0 0154.022 54.02zm175.707 42.568q-8.797 8.178-24.405 8.177a34.858 34.858.0 01-17.095-3.965 33.188 33.188.0 01-11.643-10.529 46.374 46.374.0 01-6.566-14.99 71.134 71.134.0 01-2.105-17.341 86.99 86.99.0 011.982-18.706 46.804 46.804.0 016.565-15.98 34.028 34.028.0 0112.263-11.149q7.675-4.21 19.077-4.212 13.38.0 21.306 6.69 7.927 6.689 10.405 18.829h21.803a50.76 50.76.0 00-5.946-19.696 44.06 44.06.0 00-12.015-13.75 49.842 49.842.0 00-16.848-8.051 77.44 77.44.0 00-20.44-2.601q-15.114.0-26.509 5.326a52.935 52.935.0 00-18.952 14.617 62.165 62.165.0 00-11.273 21.8 94.013 94.013.0 00-3.717 26.883 86.195 86.195.0 003.84 26.386 57.783 57.783.0 0011.397 20.686 50.138 50.138.0 0018.829 13.38 66.766 66.766.0 0025.891 4.705q24.527.0 38.772-12.882 14.245-12.878 17.715-36.668h-21.556q-1.986 14.867-10.776 23.041zm157.44-87.828a56.338 56.338.0 00-19.447-14.244q-11.52-5.203-26.882-5.203-15.115.0-26.756 5.203a56.009 56.009.0 00-19.573 14.244 59.75 59.75.0 00-11.892 21.307 85.299 85.299.0 00-3.965 26.386 84.117 84.117.0 003.965 26.262 59.853 59.853.0 0011.892 21.183 54.61 54.61.0 0019.573 14.12q11.643 5.077 26.756 5.08 15.36.0 26.882-5.08a54.908 54.908.0 0019.447-14.12 59.95 59.95.0 0011.892-21.183 84.181 84.181.0 003.965-26.262 85.364 85.364.0 00-3.965-26.386 59.846 59.846.0 00-11.892-21.307zm-9.538 68.38a43.305 43.305.0 01-8.548 15.113 37.061 37.061.0 01-12.759 9.29 38.825 38.825.0 01-30.968.0 37.003 37.003.0 01-12.76-9.29 43.209 43.209.0 01-8.547-15.114 70.669 70.669.0 010-41.373 44.634 44.634.0 018.547-15.237 36.428 36.428.0 0112.76-9.415 38.826 38.826.0 0130.968.0 36.484 36.484.0 0112.76 9.415 44.735 44.735.0 018.547 15.237 70.624 70.624.0 010 41.373zm81.141-80.89q-11.147 7.434-18.83 23.041h-.493v-27.005h-19.82V287.78h21.057v-56.984a87.528 87.528.0 012.478-21.924 41.993 41.993.0 017.93-16.228 33.951 33.951.0 0114.368-10.158q8.919-3.468 21.555-3.468V156.72q-17.097-.493-28.245 6.937zm80.761-42.366h-21.06v38.402h-21.8v18.581h21.8v81.51a48.668 48.668.0 001.734 14.37 17.432 17.432.0 005.326 8.423 20.57 20.57.0 009.415 4.088 75.59 75.59.0 0013.999 1.115h16.104v-18.582h-9.664a70.335 70.335.0 01-8.05-.37 10.361 10.361.0 01-4.833-1.611 6.108 6.108.0 01-2.354-3.469 23.006 23.006.0 01-.617-5.946v-79.528h25.518v-18.581h-25.518zm148.522 60.452a56.135 56.135.0 00-18.085-17.962q-11.276-7.063-28.367-7.06a58.263 58.263.0 00-24.155 4.953A56.796 56.796.0 00925.82 175.55a63.949 63.949.0 00-12.51 21.058 77.064 77.064.0 00-4.461 26.758 102.521 102.521.0 004.338 27.004 58.87 58.87.0 0011.519 21.307 52.43 52.43.0 0018.953 13.873q11.272 4.954 26.632 4.955 21.8.0 36.173-10.901 14.364-10.898 18.58-32.455h-20.81q-2.73 12.635-11.272 18.829-8.549 6.198-21.927 6.195a43.577 43.577.0 01-18.085-3.468 35.417 35.417.0 01-12.636-9.291 36.127 36.127.0 01-7.184-13.38 50.746 50.746.0 01-1.981-15.98h95.879a102.07 102.07.0 00-2.107-24.526 71.064 71.064.0 00-9.415-23.784zm-84.357 29.73a43.81 43.81.0 013.219-13.999 37.354 37.354.0 017.433-11.52 34.013 34.013.0 0111.272-7.803 36.694 36.694.0 0114.74-2.85 36.062 36.062.0 0114.494 2.85 36.492 36.492.0 0111.398 7.68 36.107 36.107.0 017.68 11.52 43.253 43.253.0 013.345 14.122zm170.95 7.184 44.1-58.964h-25.271l-31.961 44.843-30.721-44.843h-27.006l44.595 60.698-48.063 67.389h25.518l35.677-53.019 35.676 53.019h27.006l-49.55-69.123z" class="cls-1"/></svg></span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class="nav-link active" href=/docs/><span class=active>Documentation</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/blog/><span>Blog</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a href=https://twitter.com/cortexmetrics class="nav-link active"><span class=active><i class="fab fa-fw fa-twitter"></i> Twitter</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a href=https://github.com/cortexproject class="nav-link active"><span class=active><i class="fab fa-fw fa-github"></i> GitHub</span></a></li></ul></div><div class="navbar-nav d-none d-md-block"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.a09fdcd94b7c119b29b5add3035f8e5f.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><aside class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"><div id=td-sidebar-menu class=td-sidebar__inner><div id=content-mobile><form class="td-sidebar__search d-flex align-items-center"><input type=search class="form-control td-search-input" placeholder="&#xf002; Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.a09fdcd94b7c119b29b5add3035f8e5f.json data-offline-search-base-href=/ data-offline-search-max-results=10>
<button class="btn btn-link td-sidebar__toggle d-md-none p-0 ml-3 fas fa-bars" type=button data-toggle=collapse data-target=#td-section-nav aria-controls=td-section-nav aria-expanded=false aria-label="Toggle section navigation"></button></form></div><div id=content-desktop></div><nav class="collapse td-sidebar-nav" id=td-section-nav><ul class="td-sidebar-nav__section pr-md-3 ul-0"><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docs-li><a href=/docs/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section tree-root" id=m-docs><span>Documentation</span></a><ul class=ul-1><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsgetting-started-li><a href=/docs/getting-started/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsgetting-started><span>Getting Started</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsgetting-startedsingle-binary-li><a href=/docs/getting-started/single-binary/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgetting-startedsingle-binary><span>Single Binary Mode</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsgetting-startedmicroservices-li><a href=/docs/getting-started/microservices/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsgetting-startedmicroservices><span>Microservices Mode</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsarchitecture-li><a href=/docs/architecture/ title="Cortex Architecture" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsarchitecture><span>Architecture</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsblocks-storage-li><a href=/docs/blocks-storage/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsblocks-storage><span>Blocks Storage</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsblocks-storagequerier-li><a href=/docs/blocks-storage/querier/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storagequerier><span>Querier</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsblocks-storagestore-gateway-li><a href=/docs/blocks-storage/store-gateway/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storagestore-gateway><span>Store-gateway</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsblocks-storagecompactor-li><a href=/docs/blocks-storage/compactor/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storagecompactor><span>Compactor</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsblocks-storageproduction-tips-li><a href=/docs/blocks-storage/production-tips/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storageproduction-tips><span>Production tips</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsblocks-storagebinary-index-header-li><a href=/docs/blocks-storage/binary-index-header/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storagebinary-index-header><span>Binary index-header</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsblocks-storagebucket-index-li><a href=/docs/blocks-storage/bucket-index/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storagebucket-index><span>Bucket Index</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsblocks-storagemigrate-cortex-cluster-from-chunks-to-blocks-li><a href=/docs/blocks-storage/migrate-cortex-cluster-from-chunks-to-blocks/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storagemigrate-cortex-cluster-from-chunks-to-blocks><span>Migrate Cortex cluster from chunks to blocks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsblocks-storageconvert-long-term-storage-from-chunks-to-blocks-li><a href=/docs/blocks-storage/convert-long-term-storage-from-chunks-to-blocks/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storageconvert-long-term-storage-from-chunks-to-blocks><span>Convert long-term storage from chunks to blocks</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsblocks-storagemigrate-storage-from-thanos-and-prometheus-li><a href=/docs/blocks-storage/migrate-storage-from-thanos-and-prometheus/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storagemigrate-storage-from-thanos-and-prometheus><span>Migrate the storage from Thanos and Prometheus</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsblocks-storagelearn-more-li><a href=/docs/blocks-storage/learn-more/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsblocks-storagelearn-more><span>Learn more</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsconfiguration-li><a href=/docs/configuration/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsconfiguration><span>Configuration</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsconfigurationconfiguration-file-li><a href=/docs/configuration/configuration-file/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsconfigurationconfiguration-file><span>Configuration file</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsconfigurationarguments-li><a href=/docs/configuration/arguments/ title="Cortex Arguments" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsconfigurationarguments><span>Cortex Arguments Explained</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsconfigurationprometheus-frontend-li><a href=/docs/configuration/prometheus-frontend/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsconfigurationprometheus-frontend><span>Prometheus Frontend</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsconfigurationv1guarantees-li><a href=/docs/configuration/v1guarantees/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsconfigurationv1guarantees><span>v1.x Guarantees</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsguides-li><a href=/docs/guides/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsguides><span>Guides</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesrunning-cortex-on-kubernetes-li><a href=/docs/guides/running-cortex-on-kubernetes/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesrunning-cortex-on-kubernetes><span>Running Cortex on Kubernetes</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesgetting-started-with-gossiped-ring-li><a href=/docs/guides/getting-started-with-gossiped-ring/ title="Getting started with gossiped ring" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesgetting-started-with-gossiped-ring><span>Getting started with a gossip ring cluster</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesalertmanager-configuration-li><a href=/docs/guides/alertmanager-configuration/ title="Configuring Notification using Cortex Alertmanager" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesalertmanager-configuration><span>Alertmanager configuration</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesauth-li><a href=/docs/guides/auth/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesauth><span>Authentication and Authorisation</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidescapacity-planning-li><a href=/docs/guides/capacity-planning/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidescapacity-planning><span>Capacity Planning</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesruler-sharding-li><a href=/docs/guides/ruler-sharding/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesruler-sharding><span>Config for horizontally scaling the Ruler</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesha-pair-handling-li><a href=/docs/guides/ha-pair-handling/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesha-pair-handling><span>Config for sending HA Pairs data to Cortex</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesencryption-at-rest-li><a href=/docs/guides/encryption-at-rest/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesencryption-at-rest><span>Encryption at Rest</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesingesters-rolling-updates-li><a href=/docs/guides/ingesters-rolling-updates/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesingesters-rolling-updates><span>Ingesters rolling updates</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesingesters-scaling-up-and-down-li><a href=/docs/guides/ingesters-scaling-up-and-down/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesingesters-scaling-up-and-down><span>Ingesters scaling up and down</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesnative-histograms-li><a href=/docs/guides/native-histograms/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesnative-histograms><span>Native Histograms</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesoverrides-exporter-li><a href=/docs/guides/overrides-exporter/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesoverrides-exporter><span>Overrides Exporter</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidespartition-compaction-li><a href=/docs/guides/partition-compaction/ title="Use Partition Compaction in Cortex" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidespartition-compaction><span>Partition Compaction</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesrule-evalutions-via-query-frontend-li><a href=/docs/guides/rule-evalutions-via-query-frontend/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesrule-evalutions-via-query-frontend><span>Rule evaluations via query frontend</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidestls-li><a href=/docs/guides/tls/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidestls><span>Securing communication between Cortex components with TLS</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidessecurity-li><a href=/docs/guides/security/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidessecurity><span>Security</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesshuffle-sharding-li><a href=/docs/guides/shuffle-sharding/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesshuffle-sharding><span>Shuffle Sharding</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidestracing-li><a href=/docs/guides/tracing/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidestracing><span>Tracing</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesuse-opentelemetry-collector-to-send-metrics-to-cortex-li><a href=/docs/guides/use-opentelemetry-collector-to-send-metrics-to-cortex/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesuse-opentelemetry-collector-to-send-metrics-to-cortex><span>Use OpenTelemetry Collector to send metrics to Cortex</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguideszone-aware-replication-li><a href=/docs/guides/zone-aware-replication/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguideszone-aware-replication><span>Zone Aware Replication</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesparquet-mode-li><a href=/docs/guides/parquet-mode/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesparquet-mode><span>Parquet Mode</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesprotecting-cortex-from-heavy-queries-li><a href=/docs/guides/protecting-cortex-from-heavy-queries/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesprotecting-cortex-from-heavy-queries><span>Protecting Cortex from Heavy Queries</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidestenant-id-naming-conventions-li><a href=/docs/guides/tenant-id-naming-conventions/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidestenant-id-naming-conventions><span>Tenant ID Naming Conventions</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsguidesglossary-li><a href=/docs/guides/glossary/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsguidesglossary><span>Glossary</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsapi-li><a href=/docs/api/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsapi><span>HTTP API</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docsoperations-li><a href=/docs/operations/ title="Operating Cortex" class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsoperations><span>Operations</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsoperationsquery-auditor-li><a href=/docs/operations/query-auditor/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsoperationsquery-auditor><span>Query Auditor (tool)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsoperationsquery-tee-li><a href=/docs/operations/query-tee/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsoperationsquery-tee><span>Query Tee (service)</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsoperationsrequests-mirroring-to-secondary-cluster-li><a href=/docs/operations/requests-mirroring-to-secondary-cluster/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsoperationsrequests-mirroring-to-secondary-cluster><span>Requests mirroring to secondary cluster</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docsoperationsscaling-query-frontend-li><a href=/docs/operations/scaling-query-frontend/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsoperationsscaling-query-frontend><span>Scaling the Query Frontend</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docscase-studies-li><a href=/docs/case-studies/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docscase-studies><span>Case Studies</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscase-studiesgojek-li><a href=/docs/case-studies/gojek/ title="How Gojek Is Leveraging Cortex to Keep Up with Its Ever-Growing Scale" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscase-studiesgojek><span>Gojek</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscase-studiesrewe-digital-li><a href=/docs/case-studies/rewe-digital/ title="How Cortex helped REWE digital ensure stability while scaling services during the Covid-19 pandemic" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscase-studiesrewe-digital><span>REWE digital</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscase-studiesbuoyant-cloud-li><a href=/docs/case-studies/buoyant-cloud/ title="Buoyant Cloud and Cortex: Standing on the shoulders of Linkerd and Prometheus" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscase-studiesbuoyant-cloud><span>Buoyant Cloud</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child active-path" id=m-docsproposals-li><a href=/docs/proposals/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docsproposals><span>Proposals</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposalsauth-gateway-li><a href=/docs/proposals/auth-gateway/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsauth-gateway><span>Authentication Gateway</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposalsblocks-storage-bucket-index-li><a href=/docs/proposals/blocks-storage-bucket-index/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsblocks-storage-bucket-index><span>Blocks storage bucket index</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposalsblocks-storage-sharding-li><a href=/docs/proposals/blocks-storage-sharding/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsblocks-storage-sharding><span>Blocks storage sharding</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposalscross-tenant-query-federation-li><a href=/docs/proposals/cross-tenant-query-federation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalscross-tenant-query-federation><span>Cross-Tenant Query Federation</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child active-path" id=m-docsproposalscrossplane-provider-for-cortex-li><a href=/docs/proposals/crossplane-provider-for-cortex/ class="align-left pl-0 active td-sidebar-link td-sidebar-link__page" id=m-docsproposalscrossplane-provider-for-cortex><span class=td-sidebar-nav-active-item>Crossplane Provider for Cortex</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposalstenant-deletion-li><a href=/docs/proposals/tenant-deletion/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalstenant-deletion><span>Deletion of Tenant Data from Blocks Storage</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposalsdistributed-query-execution-li><a href=/docs/proposals/distributed-query-execution/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsdistributed-query-execution><span>Distributed Query Execution</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposalsdocumentation-versioning-li><a href=/docs/proposals/documentation-versioning/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsdocumentation-versioning><span>Documentation Versioning</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposalsgeneralize-modules-li><a href=/docs/proposals/generalize-modules/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsgeneralize-modules><span>Generalize Modules Service to make it extensible</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposalshttp-api-design-li><a href=/docs/proposals/http-api-design/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalshttp-api-design><span>HTTP API Design</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposalsingesters-migration-li><a href=/docs/proposals/ingesters-migration/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsingesters-migration><span>Migrating ingesters from chunks to blocks and back.</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposalsparallel-compaction-li><a href=/docs/proposals/parallel-compaction/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsparallel-compaction><span>Parallel Compaction by Time Interval</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposalsparquet-storage-li><a href=/docs/proposals/parquet-storage/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsparquet-storage><span>Parquet-based Storage</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposalspartition-ring-multi-az-replication-li><a href=/docs/proposals/partition-ring-multi-az-replication/ title="Partition Ring with Multi-AZ Replication" class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalspartition-ring-multi-az-replication><span>Partition Ring Multi-AZ Replication</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposalstenant-retention-li><a href=/docs/proposals/tenant-retention/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalstenant-retention><span>Retention of Tenant Data from Blocks Storage</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposalsring-multikey-li><a href=/docs/proposals/ring-multikey/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsring-multikey><span>Ring Multikey</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposalsruler-ha-li><a href=/docs/proposals/ruler-ha/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsruler-ha><span>Ruler HA</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposalsruler-high-availability-li><a href=/docs/proposals/ruler-high-availability/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsruler-high-availability><span>Ruler High Availability</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposalsruler-tenant-federation-li><a href=/docs/proposals/ruler-tenant-federation/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsruler-tenant-federation><span>Ruler Tenant Federation</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposalsscalable-alertmanager-li><a href=/docs/proposals/scalable-alertmanager/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsscalable-alertmanager><span>Scalable Alertmanager</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposalsscalable-query-frontend-li><a href=/docs/proposals/scalable-query-frontend/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsscalable-query-frontend><span>Scalable Query Frontend</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposalsshuffle-sharding-and-zone-awareness-li><a href=/docs/proposals/shuffle-sharding-and-zone-awareness/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsshuffle-sharding-and-zone-awareness><span>Shuffle sharding and zone awareness</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposalsshuffle-sharding-on-the-read-path-li><a href=/docs/proposals/shuffle-sharding-on-the-read-path/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsshuffle-sharding-on-the-read-path><span>Shuffle sharding on the read path</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposalssupport-metadata-api-li><a href=/docs/proposals/support-metadata-api/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalssupport-metadata-api><span>Support metadata API</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposalsblock-storage-time-series-deletion-li><a href=/docs/proposals/block-storage-time-series-deletion/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsblock-storage-time-series-deletion><span>Time Series Deletion from Blocks Storage</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposalstimeseries-partitioning-in-compactor-li><a href=/docs/proposals/timeseries-partitioning-in-compactor/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalstimeseries-partitioning-in-compactor><span>Timeseries Partitioning in Compactor</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsproposalsoverrides-api-li><a href=/docs/proposals/overrides-api/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsproposalsoverrides-api><span>User Overrides API</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section with-child" id=m-docscontributing-li><a href=/docs/contributing/ class="align-left pl-0 td-sidebar-link td-sidebar-link__section" id=m-docscontributing><span>Contributing</span></a><ul class="ul-2 foldable"><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscontributinggovernance-li><a href=/docs/contributing/governance/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscontributinggovernance><span>Governance</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscontributingdesign-patterns-and-code-conventions-li><a href=/docs/contributing/design-patterns-and-code-conventions/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscontributingdesign-patterns-and-code-conventions><span>Design patterns and Code conventions</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscontributinghow-to-run-the-website-locally-li><a href=/docs/contributing/how-to-run-the-website-locally/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscontributinghow-to-run-the-website-locally><span>How to run the website locally</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscontributinghow-to-upgrade-golang-version-li><a href=/docs/contributing/how-to-upgrade-golang-version/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscontributinghow-to-upgrade-golang-version><span>How to upgrade Golang version</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscontributinghow-integration-tests-work-li><a href=/docs/contributing/how-integration-tests-work/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscontributinghow-integration-tests-work><span>How integration tests work</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscontributinghow-to-update-the-build-image-li><a href=/docs/contributing/how-to-update-the-build-image/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscontributinghow-to-update-the-build-image><span>How to update the build image</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child collapse" id=m-docscontributinghow-to-add-a-maintainer-li><a href=/docs/contributing/how-to-add-a-maintainer/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscontributinghow-to-add-a-maintainer><span>How to add a maintainer</span></a></li></ul></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docsroadmap-li><a href=/docs/roadmap/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docsroadmap><span>Roadmap</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docschangelog-li><a href=/docs/changelog/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docschangelog><span>Changelog</span></a></li><li class="td-sidebar-nav__section-title td-sidebar-nav__section without-child" id=m-docscode-of-conduct-li><a href=/docs/code-of-conduct/ class="align-left pl-0 td-sidebar-link td-sidebar-link__page" id=m-docscode-of-conduct><span>Code of Conduct</span></a></li></ul></li></ul></nav></div></aside><aside class="d-none d-xl-block col-xl-2 td-sidebar-toc d-print-none"><div class="td-page-meta ml-2 pb-1 pt-2 mb-0"><a href=https://github.com/cortexproject/cortex/edit/master/docs/proposals/crossplane-provider.md target=_blank><i class="fa fa-edit fa-fw"></i> Edit this page</a>
<a href="https://github.com/cortexproject/cortex/issues/new?title=Crossplane%20Provider%20for%20Cortex" target=_blank><i class="fab fa-github fa-fw"></i> Create documentation issue</a>
<a href=https://github.com/cortexproject/cortex/issues/new target=_blank><i class="fas fa-tasks fa-fw"></i> Create project issue</a></div><div class=td-toc><nav id=TableOfContents><ul><li><a href=#overview>Overview</a></li><li><a href=#current-state>Current State</a></li><li><a href=#proposal>Proposal</a><ul><li><a href=#goals>Goals</a></li><li><a href=#non-goals>Non-Goals</a></li></ul></li><li><a href=#design>Design</a><ul><li><a href=#architecture-overview>Architecture Overview</a></li><li><a href=#custom-resource-definitions-crds>Custom Resource Definitions (CRDs)</a></li><li><a href=#provider-components>Provider Components</a></li><li><a href=#configuration-management>Configuration Management</a></li><li><a href=#observability>Observability</a></li></ul></li><li><a href=#compatibility>Compatibility</a><ul><li><a href=#crossplane-versions>Crossplane Versions</a></li><li><a href=#cortex-versions>Cortex Versions</a></li><li><a href=#ruler-storage-backends>Ruler Storage Backends</a></li><li><a href=#api-fallback-support>API Fallback Support</a></li></ul></li><li><a href=#security-considerations>Security Considerations</a><ul><li><a href=#authentication-and-authorization>Authentication and Authorization</a></li><li><a href=#network-security>Network Security</a></li><li><a href=#multi-tenancy>Multi-tenancy</a></li></ul></li><li><a href=#alternatives-considered>Alternatives Considered</a><ul><li><a href=#alternative-1-helm-charts-only>Alternative 1: Helm Charts Only</a></li><li><a href=#alternative-2-traditional-kubernetes-operators>Alternative 2: Traditional Kubernetes Operators</a></li><li><a href=#alternative-3-terraform-providers>Alternative 3: Terraform Providers</a></li></ul></li><li><a href=#open-questions>Open Questions</a><ul><li><a href=#implementation-and-technical-questions>Implementation and Technical Questions</a></li><li><a href=#operational-and-deployment-questions>Operational and Deployment Questions</a></li></ul></li><li><a href=#references>References</a></li></ul></nav></div><div class="taxonomy taxonomy-terms-cloud taxo-projects"><h5 class=taxonomy-title>Our Projects</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=/projects/cortex/ data-taxonomy-term=cortex><span class=taxonomy-label>cortex</span><span class=taxonomy-count>6</span></a></li></ul></div><div class="taxonomy taxonomy-terms-cloud taxo-tags"><h5 class=taxonomy-title>Tag Cloud</h5><ul class=taxonomy-terms><li><a class=taxonomy-term href=/tags/blog/ data-taxonomy-term=blog><span class=taxonomy-label>blog</span><span class=taxonomy-count>6</span></a></li><li><a class=taxonomy-term href=/tags/community/ data-taxonomy-term=community><span class=taxonomy-label>community</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/cortex/ data-taxonomy-term=cortex><span class=taxonomy-label>cortex</span><span class=taxonomy-count>6</span></a></li><li><a class=taxonomy-term href=/tags/ingester/ data-taxonomy-term=ingester><span class=taxonomy-label>ingester</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/optimization/ data-taxonomy-term=optimization><span class=taxonomy-label>optimization</span><span class=taxonomy-count>3</span></a></li><li><a class=taxonomy-term href=/tags/query/ data-taxonomy-term=query><span class=taxonomy-label>query</span><span class=taxonomy-count>4</span></a></li><li><a class=taxonomy-term href=/tags/rejection/ data-taxonomy-term=rejection><span class=taxonomy-label>rejection</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/scaling/ data-taxonomy-term=scaling><span class=taxonomy-label>scaling</span><span class=taxonomy-count>1</span></a></li><li><a class=taxonomy-term href=/tags/updates/ data-taxonomy-term=updates><span class=taxonomy-label>updates</span><span class=taxonomy-count>1</span></a></li></ul></div></aside><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><nav aria-label=breadcrumb class=td-breadcrumbs><ol class=breadcrumb><li class=breadcrumb-item><a href=/docs/>Documentation</a></li><li class=breadcrumb-item><a href=/docs/proposals/>Proposals</a></li><li class="breadcrumb-item active" aria-current=page><a href=/docs/proposals/crossplane-provider-for-cortex/ aria-disabled=true class="btn-link disabled">Crossplane Provider for Cortex</a></li></ol></nav><div class=td-content><h1>Crossplane Provider for Cortex</h1><header class=article-meta></header><ul><li>Author: <a href=https://github.com/zanderfriz>Alex Frisvold</a></li><li>Date: 10/1/2025</li><li>Status: Proposed</li></ul><h2 id=overview>Overview</h2><p>This proposal outlines the development of a Crossplane provider for Cortex that enables declarative management of a Cortex tenant&rsquo;s recording rules, alerting rules, and Alertmanager configurations through Kubernetes Custom Resources.</p><h2 id=current-state>Current State</h2><p>Currently, a Cortex tenant&rsquo;s recording rules, alerting rules, and Alertmanager configurations are managed through a variety of methods:</p><ul><li>Manual API calls to configure alerting rules and alertmanager settings</li><li><a href=https://github.com/cortexproject/cortex-tools>cortextool</a> CLI that directly interacts with Cortex APIs</li><li>Configuration files deployed via traditional Kubernetes deployments or ConfigMaps</li></ul><p>This approach leads to several challenges:</p><ul><li><strong>Configuration Drift</strong>: Manual changes and inconsistent deployment practices result in environments becoming out of sync</li><li><strong>Limited Observability</strong>: No standardized way to track the status and health of Cortex configurations</li><li><strong>Security Concerns</strong>: Authentication credentials are often embedded in scripts or stored insecurely</li><li><strong>Tenant Isolation</strong>: Difficult to enforce proper isolation and governance controls across multiple tenants</li><li><strong>No GitOps Integration</strong>: Configurations cannot be easily managed through standard Kubernetes workflows</li></ul><h2 id=proposal>Proposal</h2><p>This proposal introduces a Crossplane provider that enables declarative management of Cortex configurations through Kubernetes Custom Resources. The provider implements three core resources that address the key aspects of Cortex management:</p><ol><li><strong>TenantConfig</strong>: Manages connection details and authentication for specific Cortex tenants</li><li><strong>RuleGroup</strong>: Declaratively manages Prometheus alerting and recording rules</li><li><strong>AlertmanagerConfig</strong>: Manages Alertmanager configuration for handling alert notifications</li></ol><p>The provider leverages Crossplane&rsquo;s composition and configuration capabilities to provide:</p><ul><li>Secure credential management through Kubernetes secrets</li><li>Declarative configuration management with drift detection</li><li>Multi-tenant isolation and governance controls</li><li>Integration with GitOps workflows</li><li>Comprehensive observability and status reporting</li></ul><h3 id=goals>Goals</h3><ul><li>Enable declarative management of Cortex ruler configurations, alerting rules, and Alertmanager configurations through Kubernetes CRDs</li><li>Provide secure authentication and credential management for multi-tenant Cortex environments</li><li>Support multiple authentication methods including bearer tokens, basic auth, and mTLS</li><li>Implement comprehensive observability and status reporting for all managed resources</li><li>Enable platform teams to provide self-service capabilities to development teams while maintaining governance controls</li><li>Support GitOps workflows for configuration management and deployment</li></ul><h3 id=non-goals>Non-Goals</h3><ul><li>This provider does NOT manage the deployment or lifecycle of Cortex infrastructure itself (clusters, storage, etc.)</li><li>Does not provide backup and restore capabilities for Cortex data</li><li>Does not implement custom Cortex extensions or plugins</li><li>Scope is limited to configuration management, not performance tuning or capacity planning</li></ul><h2 id=design>Design</h2><h3 id=architecture-overview>Architecture Overview</h3><p>The provider follows Crossplane&rsquo;s standard architecture pattern with three main components:</p><pre tabindex=0><code>┌─────────────────┐    ┌─────────────────┐    ┌──────────────────┐
│   TenantConfig  │    │   RuleGroup     │    │AlertmanagerConfig│
│                 │    │                 │    │                  │
│ - Connection    │    │ - Rules Mgmt    │    │ - AM Config      │
│ - Auth Details  │    │ - PromQL        │    │ - Templates      │
│ - TLS Config    │    │ - Evaluation    │    │ - Routing        │
└─────────┬───────┘    └─────────┬───────┘    └─────────┬────────┘
          │                      │                      │
          └──────────────────────┼──────────────────────┘
                                 │
                    ┌─────────────────────┐
                    │ Crossplane Provider │
                    │                     │
                    │ - Authentication    │
                    │ - HTTP Client       │
                    │ - Reconciliation    │
                    │ - Status Reporting  │
                    └─────────┬───────────┘
                              │
                    ┌─────────────────────┐
                    │   Cortex Cluster    │
                    │                     │
                    │ - Ruler API         │
                    │ - Alertmanager API  │
                    │ - Multi-tenant      │
                    └─────────────────────┘
</code></pre><p>The provider implements controllers for each Custom Resource Definition (CRD) that handle:</p><ol><li><strong>Authentication Management</strong>: Secure retrieval and caching of credentials from Kubernetes secrets</li><li><strong>HTTP Client Management</strong>: Configurable HTTP clients with TLS support and custom headers based on Cortex&rsquo;s own go client code</li><li><strong>Reconciliation Logic</strong>: Ensures desired state matches actual state in Cortex</li><li><strong>Status Reporting</strong>: Provides detailed feedback on resource health and synchronization status</li><li><strong>Drift Detection</strong>: Monitors for changes and automatically reconciles configurations</li></ol><h3 id=custom-resource-definitions-crds>Custom Resource Definitions (CRDs)</h3><h4 id=tenantconfig>TenantConfig</h4><p>The TenantConfig CRD manages connection details and authentication for a specific Cortex tenant:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>config.cortexmetrics.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>TenantConfig</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>production-tenant</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>tenant</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>forProvider</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>tenantId</span>: <span style=color:#e6db74>&#34;production&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>endpoint</span>: <span style=color:#e6db74>&#34;https://cortex.company.com&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>authMethod</span>: <span style=color:#e6db74>&#34;bearer&#34;</span>  <span style=color:#75715e># bearer, basic, or none</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>bearerTokenSecretRef</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>cortex-token</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>key</span>: <span style=color:#ae81ff>token</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>tlsConfig</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>insecureSkipVerify</span>: <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>caBundleSecretRef</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>name</span>: <span style=color:#ae81ff>cortex-ca-bundle</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>key</span>: <span style=color:#ae81ff>ca-bundle.crt</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>additionalHeaders</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;X-Custom-Header&#34;: </span><span style=color:#e6db74>&#34;custom-value&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>providerConfigRef</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>cortex-config</span>
</span></span><span style=display:flex><span><span style=color:#f92672>status</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>atProvider</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>tenantId</span>: <span style=color:#e6db74>&#34;production&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>connectionStatus</span>: <span style=color:#e6db74>&#34;Connected&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>lastConnectionTime</span>: <span style=color:#e6db74>&#34;2025-01-01T10:30:00Z&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>authMethod</span>: <span style=color:#e6db74>&#34;bearer&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>conditions</span>:
</span></span><span style=display:flex><span>  - <span style=color:#f92672>type</span>: <span style=color:#ae81ff>Ready</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>status</span>: <span style=color:#e6db74>&#34;True&#34;</span>
</span></span><span style=display:flex><span>  - <span style=color:#f92672>type</span>: <span style=color:#ae81ff>Synced</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>status</span>: <span style=color:#e6db74>&#34;True&#34;</span>
</span></span></code></pre></div><p><strong>Key Features:</strong></p><ul><li>Support for multiple authentication methods (bearer token, basic auth, mTLS)</li><li>Flexible TLS configuration including custom CA bundles and client certificates</li><li>Custom HTTP headers for additional authentication or routing</li><li>Connection health monitoring and status reporting</li></ul><h4 id=rulegroup>RuleGroup</h4><p>The RuleGroup CRD manages Prometheus alerting and recording rules within a Cortex namespace:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>config.cortexmetrics.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>RuleGroup</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>cpu-monitoring</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>tenant</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>forProvider</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>tenantConfigRef</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>production-tenant</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>namespace</span>: <span style=color:#e6db74>&#34;monitoring&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>groupName</span>: <span style=color:#e6db74>&#34;cpu-alerts&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>interval</span>: <span style=color:#e6db74>&#34;30s&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>rules</span>:
</span></span><span style=display:flex><span>    <span style=color:#75715e># Alerting rule - fires when node CPU usage exceeds 80%</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>alert</span>: <span style=color:#ae81ff>HighCPUUsage</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>expr</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        </span>        <span style=color:#ae81ff>100</span> - <span style=color:#ae81ff>(avg by (instance) (rate(node_cpu_seconds_total{mode=&#34;idle&#34;}[5m])) * 100) &gt; 80</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>for</span>: <span style=color:#e6db74>&#34;5m&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>severity</span>: <span style=color:#e6db74>&#34;warning&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>team</span>: <span style=color:#e6db74>&#34;platform&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>annotations</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>summary</span>: <span style=color:#e6db74>&#34;High CPU usage on {{ $labels.instance }}&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>description</span>: <span style=color:#e6db74>&#34;CPU usage is {{ $value | humanize }}% (above 80% threshold for 5 minutes)&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Recording rule - pre-calculates node CPU usage percentage for dashboards</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>record</span>: <span style=color:#ae81ff>instance_cpu_usage_percent</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>expr</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        </span>        <span style=color:#ae81ff>100</span> - <span style=color:#ae81ff>(avg by (instance) (rate(node_cpu_seconds_total{mode=&#34;idle&#34;}[5m])) * 100)</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>job</span>: <span style=color:#e6db74>&#34;node-exporter&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>status</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>atProvider</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>namespace</span>: <span style=color:#e6db74>&#34;monitoring&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>groupName</span>: <span style=color:#e6db74>&#34;cpu-alerts&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ruleCount</span>: <span style=color:#ae81ff>2</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>lastUpdated</span>: <span style=color:#e6db74>&#34;2025-01-01T10:35:00Z&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>status</span>: <span style=color:#e6db74>&#34;Active&#34;</span>
</span></span></code></pre></div><p><strong>Key Features:</strong></p><ul><li>Support for both alerting rules (using <code>alert:</code> field) and recording rules (using <code>record:</code> field)</li><li>Rules specify their type explicitly using either <code>alert:</code> or <code>record:</code> field</li><li>PromQL expression validation</li><li>Configurable evaluation intervals</li><li>Flexible labeling and annotation support</li><li>Alerting rules support <code>annotations</code> and <code>for</code> duration fields</li><li>Rule count and status monitoring</li></ul><h4 id=alertmanagerconfig>AlertmanagerConfig</h4><p>The AlertmanagerConfig CRD manages Alertmanager configuration including routing rules, receivers, and notification templates:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>config.cortexmetrics.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>AlertmanagerConfig</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>production-alerting</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>tenant</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>forProvider</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>tenantConfigRef</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#ae81ff>production-tenant</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>alertmanagerConfig</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      global:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        resolve_timeout: 5m
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        smtp_smarthost: &#39;smtp.company.com:587&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      route:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        group_by: [&#39;alertname&#39;, &#39;cluster&#39;]
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        group_wait: 10s
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        group_interval: 10s
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        repeat_interval: 1h
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        receiver: &#39;platform-team&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        routes:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - match:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>            severity: critical
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          receiver: &#39;critical-alerts&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      receivers:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - name: &#39;platform-team&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        email_configs:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - to: &#39;platform@company.com&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          subject: &#39;Alert: {{ .GroupLabels.alertname }}&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          body: &#39;{{ template &#34;alert.html&#34; . }}&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - name: &#39;critical-alerts&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        slack_configs:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        - api_url: &#39;https://hooks.slack.com/services/...&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          channel: &#39;#critical-alerts&#39;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          title: &#39;Critical Alert: {{ .GroupLabels.alertname }}&#39;</span>      
</span></span><span style=display:flex><span>    <span style=color:#f92672>templateFiles</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>alert.html</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;h2&gt;Alert Details&lt;/h2&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {{ range .Alerts }}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;p&gt;&lt;strong&gt;{{ .Annotations.summary }}&lt;/strong&gt;&lt;/p&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        &lt;p&gt;{{ .Annotations.description }}&lt;/p&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        {{ end }}</span>        
</span></span><span style=display:flex><span><span style=color:#f92672>status</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>atProvider</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>configurationStatus</span>: <span style=color:#e6db74>&#34;Applied&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>lastUpdated</span>: <span style=color:#e6db74>&#34;2025-01-01T10:40:00Z&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>configHash</span>: <span style=color:#e6db74>&#34;abc123def456&#34;</span>
</span></span></code></pre></div><p><strong>Key Features:</strong></p><ul><li>Full Alertmanager configuration management</li><li>Support for notification templates</li><li>Configuration validation and syntax checking</li><li>Hash-based change detection</li><li>Template file management</li></ul><h3 id=provider-components>Provider Components</h3><h4 id=controller-architecture>Controller Architecture</h4><p>The provider implements three controllers following Crossplane&rsquo;s managed resource pattern:</p><p><strong>TenantConfig Controller:</strong></p><ul><li>Manages HTTP client instances with authentication and TLS configuration</li><li>Validates connection to Cortex endpoints and reports connection status</li><li>Caches authentication tokens and manages credential refresh</li><li>Monitors endpoint health and Cortex version compatibility</li></ul><p><strong>RuleGroup Controller:</strong></p><ul><li>Validates PromQL expressions before applying to Cortex</li><li>Validates rule structure with clear error messages for configuration mistakes</li><li>Manages rule group lifecycle (create, update, delete) via Cortex Ruler API</li><li>Tracks rule evaluation status and provides detailed error reporting</li><li>Supports alerting rules with <code>alert</code> name, <code>for</code> duration, and <code>annotations</code></li><li>Supports recording rules with <code>record</code> name for pre-computed metrics</li></ul><p><strong>AlertmanagerConfig Controller:</strong></p><ul><li>Validates Alertmanager configuration syntax using built-in validation</li><li>Manages configuration and template files via Cortex Alertmanager API</li><li>Implements hash-based change detection to minimize API calls</li><li>Provides detailed feedback on configuration parsing and validation errors</li></ul><h4 id=resource-management>Resource Management</h4><p>The provider manages resources through a consistent pattern:</p><ol><li><p><strong>Reconciliation Loop</strong>: Each controller runs a reconciliation loop that:</p><ul><li>Fetches the current state from Cortex APIs</li><li>Compares with desired state from Kubernetes CRD</li><li>Applies necessary changes via HTTP API calls</li><li>Updates resource status with current state and any errors</li></ul></li><li><p><strong>External Resource Identification</strong>: Resources are identified using:</p><ul><li>TenantConfig: Combination of endpoint and tenant ID</li><li>RuleGroup: Namespace and group name within the tenant</li><li>AlertmanagerConfig: Tenant-specific Alertmanager configuration</li></ul></li><li><p><strong>Dependency Management</strong>: Resources reference each other using Crossplane&rsquo;s reference resolution:</p><ul><li>RuleGroup and AlertmanagerConfig reference TenantConfig for connection details</li><li>Changes to TenantConfig trigger reconciliation of dependent resources</li></ul></li></ol><h3 id=configuration-management>Configuration Management</h3><p>The provider handles Cortex configuration through several mechanisms:</p><p><strong>Authentication and Security:</strong></p><ul><li>Secure retrieval of credentials from Kubernetes secrets</li><li>Support for bearer tokens, basic authentication, and mTLS</li><li>Cross-namespace secret references supported for centralized credential management</li><li>TLS certificate validation with custom CA bundles</li><li>Request timeout and retry configuration</li></ul><p><strong>API Client Management:</strong></p><ul><li>HTTP client pooling and connection reuse</li><li>Automatic retry with exponential backoff</li><li>Request/response logging for debugging</li><li>Rate limiting to prevent API overwhelm</li></ul><p><strong>Configuration Validation:</strong></p><ul><li>PromQL expression syntax validation using Prometheus parser</li><li>Rule structure validation with helpful error messages</li><li>Alertmanager configuration validation using Alertmanager&rsquo;s built-in validator</li><li>Pre-flight validation before applying changes to Cortex</li><li>Detailed error reporting for validation failures</li></ul><p><strong>Hash-Based Drift Detection:</strong></p><ul><li>Configuration hashes computed for both desired state (CRD) and current state (Cortex)</li><li>Hash comparison enables efficient drift detection without deep object comparisons</li><li>Avoids unnecessary API calls and updates when configurations are already synchronized</li><li>Metrics track both drift detected and unnecessary updates avoided</li></ul><h3 id=observability>Observability</h3><p>The provider includes comprehensive observability features:</p><p><strong>Metrics:</strong></p><ul><li><strong>Resource Metrics</strong>: Track rule group sizes, receiver counts, and configuration complexity</li><li><strong>Performance Metrics</strong>: Monitor hash calculation duration, Cortex API latency, secret retrieval, and TLS setup times</li><li><strong>Drift Detection Metrics</strong>: Track configuration drift detected and unnecessary updates avoided via hash matching</li><li><strong>Error Metrics</strong>: Classify and count API errors by type, operation, and resource</li><li><strong>Authentication Metrics</strong>: Track authentication failures by method</li><li>All metrics designed with low cardinality for efficient Prometheus operation</li></ul><p><strong>Logging:</strong>
The provider will use a <strong>debug-first logging approach</strong> with structured logging:</p><ul><li><strong>Info Level (Default)</strong>: Only critical events visible<ul><li>Drift detected (with hashes)</li><li>Connection test failures</li><li>Blocking deletion events</li><li>All errors and validation failures</li></ul></li><li><strong>Debug Level</strong> (requires <code>--debug</code> flag): Operational details<ul><li>All lifecycle operations (Connect, Observe, Create, Update, Delete)</li><li>&ldquo;No drift detected&rdquo; routine checks</li><li>Connection test start/success</li><li>API call details and hash calculations</li><li>TLS/authentication setup</li></ul></li><li><strong>Structured Fields</strong>: All logs include resource context (namespace, name, generation, tenantConfig), Cortex details (tenantID, endpoint, cortexNamespace, groupName), and operation-specific data for filtering</li></ul><p><strong>Status Reporting:</strong></p><ul><li>Standard Crossplane conditions (Ready, Synced)</li><li>Resource-specific status fields (connection status, rule count, config hash, etc.)</li><li>Last update timestamps and configuration hashes</li><li>Error details with actionable messages</li></ul><h2 id=compatibility>Compatibility</h2><h3 id=crossplane-versions>Crossplane Versions</h3><ul><li><strong>Minimum</strong>: Crossplane v2.0.0 (uses Crossplane Runtime v2)</li><li><strong>Recommended</strong>: Crossplane v2.0.2</li></ul><p><strong>Note</strong>: Crossplane Runtime v2 is not backwards compatible with Crossplane v1.x releases. This provider requires Crossplane v2.0.0 or later.</p><h3 id=cortex-versions>Cortex Versions</h3><p>The provider supports multiple Cortex versions through its flexible API client:</p><ul><li><strong>Minimum</strong>: Cortex 1.17.0+</li><li><strong>Recommended</strong>: Cortex 1.19.0+</li></ul><h3 id=ruler-storage-backends>Ruler Storage Backends</h3><p>The provider requires Cortex to be configured with a ruler storage backend that supports the full Ruler API. The following backends are supported:</p><table><thead><tr><th>Backend</th><th>Support Status</th><th>Notes</th></tr></thead><tbody><tr><td><strong>S3</strong></td><td>✅ Fully Supported</td><td>Recommended for production use. Includes S3-compatible storage like MinIO</td></tr><tr><td><strong>GCS</strong></td><td>✅ Fully Supported</td><td>Google Cloud Storage</td></tr><tr><td><strong>Azure</strong></td><td>✅ Fully Supported</td><td>Azure Blob Storage</td></tr><tr><td><strong>Swift</strong></td><td>✅ Fully Supported</td><td>OpenStack Swift</td></tr><tr><td><strong>Local</strong></td><td>❌ <strong>NOT SUPPORTED</strong></td><td>Read-only backend with no write API support</td></tr></tbody></table><p><strong>Important</strong>: Cortex&rsquo;s <code>ruler_storage.backend: local</code> is a read-only storage backend that does not support the write operations (SetRuleGroup, DeleteRuleGroup) required by this provider.</p><h3 id=api-fallback-support>API Fallback Support</h3><p>The provider implements intelligent API fallback for maximum compatibility:</p><ul><li><strong>Primary Path</strong>: Uses <code>GetRuleGroup</code> API for optimal performance on supported backends</li><li><strong>Fallback Path</strong>: Automatically falls back to <code>ListRules</code> if <code>GetRuleGroup</code> returns &ldquo;unsupported&rdquo; errors</li><li><strong>Transparency</strong>: Fallback happens automatically with no user configuration required</li></ul><p>This ensures compatibility with different Cortex configurations while maintaining optimal performance where possible.</p><h2 id=security-considerations>Security Considerations</h2><h3 id=authentication-and-authorization>Authentication and Authorization</h3><ul><li><strong>Secure Credential Storage</strong>: All credentials stored in Kubernetes secrets</li><li><strong>Principle of Least Privilege</strong>: Provider service account has minimal required permissions</li><li><strong>Bearer Token Authentication</strong>: Maintains continuous authentication using bearer tokens from secrets</li><li><strong>Audit Logging</strong>: All configuration changes are logged for security auditing</li></ul><h3 id=network-security>Network Security</h3><ul><li><strong>TLS</strong>: All HTTP communications can use TLS with certificate validation</li><li><strong>Custom CA Support</strong>: Support for private CAs and certificate pinning</li><li><strong>mTLS Authentication</strong>: Client certificate authentication for enhanced security</li><li><strong>Network Policies</strong>: Compatible with Kubernetes network policies for traffic isolation</li></ul><h3 id=multi-tenancy>Multi-tenancy</h3><ul><li><strong>Tenant Isolation</strong>: Each TenantConfig manages separate tenant credentials and configurations</li><li><strong>Namespace Isolation</strong>: Resources can be deployed in separate namespaces for isolation</li><li><strong>RBAC Integration</strong>: Leverages Kubernetes RBAC for access control</li><li><strong>Configuration Validation</strong>: Prevents cross-tenant configuration leakage</li></ul><h2 id=alternatives-considered>Alternatives Considered</h2><h3 id=alternative-1-helm-charts-only>Alternative 1: Helm Charts Only</h3><p><strong>Approach</strong>: Using Helm charts to deploy and manage Cortex configurations</p><p><strong>Limitations</strong>:</p><ul><li>No drift detection or reconciliation capabilities</li><li>Manual lifecycle management of configurations</li><li>Limited observability into configuration status</li><li>No native Kubernetes resource management integration</li><li>Difficult to implement proper multi-tenancy and isolation</li><li>Configuration updates require manual intervention</li></ul><p><strong>Conclusion</strong>: Helm charts alone are insufficient for dynamic configuration management and lack the operational benefits of Kubernetes-native resources.</p><h3 id=alternative-2-traditional-kubernetes-operators>Alternative 2: Traditional Kubernetes Operators</h3><p><strong>Approach</strong>: Building a traditional Kubernetes operator without Crossplane</p><p><strong>Comparison</strong>:</p><ul><li><strong>Pros</strong>: Direct control over implementation, no external dependencies</li><li><strong>Cons</strong>:<ul><li>Requires building and maintaining complex controller infrastructure</li><li>No composition or configuration management capabilities</li><li>Limited reusability across different Kubernetes clusters</li><li>Missing advanced features like external secret management</li><li>Significant development and maintenance overhead</li></ul></li></ul><p><strong>Conclusion</strong>: While operators provide control, Crossplane offers a mature platform with proven patterns and extensive ecosystem benefits.</p><h3 id=alternative-3-terraform-providers>Alternative 3: Terraform Providers</h3><p><strong>Approach</strong>: Using Terraform with custom providers for Cortex management</p><p><strong>Comparison</strong>:</p><ul><li><strong>State Management</strong>: Terraform state vs. Kubernetes-native status</li><li><strong>Drift Detection</strong>: Limited compared to Kubernetes controllers</li><li><strong>Integration</strong>: Separate toolchain vs. native Kubernetes workflows</li><li><strong>Observability</strong>: External monitoring vs. built-in Kubernetes observability</li><li><strong>Multi-tenancy</strong>: Complex state management vs. native namespace isolation</li></ul><p><strong>Conclusion</strong>: While Terraform is powerful for infrastructure management, Crossplane provides better integration with Kubernetes-native workflows and superior multi-tenancy support for application-level configuration management.</p><h2 id=open-questions>Open Questions</h2><h3 id=implementation-and-technical-questions>Implementation and Technical Questions</h3><ul><li><strong>Configuration Composition</strong>: How should we implement Crossplane Compositions to enable platform teams to create reusable configuration templates?</li><li><strong>Multi-cluster Support</strong>: What is the best approach for managing Cortex configurations across multiple Kubernetes clusters?</li><li><strong>Performance Optimization</strong>: What are the optimal reconciliation intervals and caching strategies for large-scale deployments?</li></ul><h3 id=operational-and-deployment-questions>Operational and Deployment Questions</h3><ul><li><strong>Provider Distribution</strong>: What is the best approach for distributing and versioning the provider package?</li><li><strong>Upgrade Strategy</strong>: How should we handle provider upgrades and backward compatibility for existing configurations?</li><li><strong>Documentation Strategy</strong>: What additional documentation and training materials are needed for successful adoption?</li></ul><h2 id=references>References</h2><ul><li><a href=https://crossplane.io/docs/>Crossplane Documentation</a> - Core platform documentation and best practices</li><li><a href=https://github.com/crossplane/crossplane-runtime/tree/main/v2>Crossplane Runtime v2</a> - Runtime library used by the provider</li><li><a href=https://cortexmetrics.io/docs/>Cortex Documentation</a> - Cortex configuration and API documentation</li><li><a href=https://cortexmetrics.io/docs/api/#ruler>Cortex Ruler API</a> - API endpoints for rule management</li><li><a href=https://cortexmetrics.io/docs/api/#alertmanager>Cortex Alertmanager API</a> - API endpoints for alertmanager configuration</li></ul></div></main></div></div><footer><div class="row td-box td-box--dark td-box--gradient td-box--height-auto text-white p-5"><div class="col-12 col-sm-4 pb-5 pb-sm-0"><img src=/images/cortex-stacked-white.png width=75px class="img-fluid float-left"></div><div class="col-12 col-sm-4 pb-5 pb-sm-0"><h6 class=font-weight-bold>Community</h6><ul class=list-unstyled><li><a href=https://slack.cncf.io class="text-reset text-white"><i class="fab fa-fw fa-slack"></i> Slack</a></li><li><a href=https://github.com/cortexproject/cortex class="text-reset text-white"><i class="fab fa-fw fa-github"></i> GitHub</a></li><li><a href=https://twitter.com/cortexmetrics class="text-reset text-white"><i class="fab fa-fw fa-twitter"></i> Twitter</a></li></ul></div><div class="col-12 col-sm-4"><h6 class=font-weight-bold>About</h6><p>Cortex is an OSS licensed project as Apache License 2.0</p></div></div><div class="row td-box td-box--dark td-box--gradient td-box--height-auto text-white p-5 text-center"><small class="col-12 text-center">© 2025 The Cortex Authors All Rights Reserved.<br>The Linux Foundation has registered trademarks and uses trademarks.
For a list of trademarks of The Linux Foundation, please see <a class="text-light alert-link" href=https://www.linuxfoundation.org/trademark-usage>Trademark Usage page</a>.</small></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.min.js integrity="sha512-UR25UO94eTnCVwjbXozyeVd6ZqpaAE9naiEUBK/A+QDbfSTQFhPGj5lOR6d8tsgbBk84Ggb5A3EkjsOgPRPcKA==" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script>
<script src=/js/main.min.91798a335c881f1b6b805085ba4aa22d1dbd2b0b18d105d05189fa104ddae350.js integrity="sha256-kXmKM1yIHxtrgFCFukqiLR29KwsY0QXQUYn6EE3a41A=" crossorigin=anonymous></script></body></html>